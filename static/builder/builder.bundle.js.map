{
  "version": 3,
  "sources": ["builder.js"],
  "sourcesContent": ["import * as f3 from '/lib/family-tree.esm.js'\r\n\r\nconst statusEl = document.getElementById('status')\r\nconst saveBtn = document.getElementById('save')\r\nconst reloadBtn = document.getElementById('reload')\r\nconst panel = document.getElementById('controlPanel')\r\nconst chartSelector = '#FamilyChart'\r\n\r\nfunction normalizeFieldKey(value) {\r\n  if (value === undefined || value === null) return ''\r\n  return String(value).trim().toLowerCase()\r\n}\r\n\r\nfunction sanitizeFieldValues(values) {\r\n  if (!Array.isArray(values)) return []\r\n  const seen = new Set()\r\n  const result = []\r\n  values.forEach(rawValue => {\r\n    if (typeof rawValue !== 'string') return\r\n    const trimmed = rawValue.trim()\r\n    if (!trimmed) return\r\n    const key = normalizeFieldKey(trimmed)\r\n    if (seen.has(key)) return\r\n    seen.add(key)\r\n    result.push(trimmed)\r\n  })\r\n  return result\r\n}\r\n\r\nconst DISPLAY_FIELD_LABELS = new Map([\r\n  ['first name', 'Pr\u00E9nom'],\r\n  ['last name', 'Nom'],\r\n  ['birthday', 'Date de naissance'],\r\n  ['death', 'Date de D\u00E9c\u00E8s'],\r\n  ['gender', 'Genre'],\r\n  ['avatar', 'Photo de profil'],\r\n  ['photo', 'Photo'],\r\n  ['picture', 'Portrait'],\r\n  ['bio', 'Biographie'],\r\n  ['occupation', 'Profession'],\r\n  ['location', 'Lieu de r\u00E9sidence'],\r\n  ['birthplace', 'Lieu de naissance'],\r\n  ['deathplace', 'Lieu de d\u00E9c\u00E8s'],\r\n  ['notes', 'Notes'],\r\n  ['nickname', 'Surnom'],\r\n  ['maiden name', 'Nom de jeune fille']\r\n])\r\n\r\nconst DISPLAY_DEFAULTS = {\r\n  1: [\r\n    { value: 'first name', checked: true },\r\n    { value: 'last name', checked: true },\r\n    { value: 'birthday', checked: false },\r\n    { value: 'avatar', checked: false },\r\n    { value: 'gender', checked: false }\r\n  ],\r\n  2: [\r\n    { value: 'birthday', checked: true },\r\n    { value: 'death', label: 'Date de D\u00E9c\u00E8s', checked: false },\r\n    { value: 'avatar', checked: false },\r\n    { value: 'gender', checked: false }\r\n  ]\r\n}\r\n\r\nconst EDITABLE_DEFAULTS = [\r\n  { value: 'first name', label: 'Pr\u00E9nom', checked: true },\r\n  { value: 'last name', label: 'Nom', checked: true },\r\n  { value: 'birthday', label: 'Date de naissance', checked: true },\r\n  { value: 'avatar', label: 'Avatar', checked: true },\r\n  { value: 'gender', label: 'Genre', checked: true },\r\n  { value: 'death', label: 'Date de D\u00E9c\u00E8s', checked: false },\r\n  { value: 'bio', label: 'Biographie', checked: false }\r\n]\r\n\r\nconst DEFAULT_CARD_DISPLAY = [\r\n  ['first name', 'last name'],\r\n  ['birthday']\r\n]\r\n\r\nconst DEFAULT_EDITABLE_FIELDS = sanitizeFieldValues(\r\n  EDITABLE_DEFAULTS\r\n    .filter(def => def.checked !== false)\r\n    .map(def => def.value)\r\n)\r\n\r\nconst TEXTAREA_FIELD_KEYS = new Set(['bio', 'notes', 'biographie', 'description'])\r\n\r\nfunction createBaseFieldLabelStore() {\r\n  const store = new Map(DISPLAY_FIELD_LABELS)\r\n  EDITABLE_DEFAULTS.forEach(def => {\r\n    store.set(normalizeFieldKey(def.value), def.label)\r\n  })\r\n  Object.values(DISPLAY_DEFAULTS).forEach(defs => {\r\n    defs.forEach(def => {\r\n      if (def.label) {\r\n        store.set(normalizeFieldKey(def.value), def.label)\r\n      }\r\n    })\r\n  })\r\n  return store\r\n}\r\n\r\nfunction buildFieldDescriptors(fields, labelStore = createBaseFieldLabelStore()) {\r\n  const store = labelStore || createBaseFieldLabelStore()\r\n  return sanitizeFieldValues(fields).map(value => {\r\n    const key = normalizeFieldKey(value)\r\n    const label = store.get(key) || value\r\n    const type = TEXTAREA_FIELD_KEYS.has(key) ? 'textarea' : 'text'\r\n    return { id: value, label, type }\r\n  })\r\n}\r\n\r\nconst DEFAULT_CHART_CONFIG = Object.freeze({\r\n  transitionTime: 200,\r\n  cardXSpacing: 240,\r\n  cardYSpacing: 140,\r\n  orientation: 'vertical',\r\n  showSiblingsOfMain: true,\r\n  singleParentEmptyCard: true,\r\n  singleParentEmptyCardLabel: 'Inconnu',\r\n  ancestryDepth: 4,\r\n  progenyDepth: 4,\r\n  miniTree: true,\r\n  duplicateBranchToggle: true,\r\n  editableFields: [...DEFAULT_EDITABLE_FIELDS],\r\n  cardDisplay: DEFAULT_CARD_DISPLAY.map(row => [...row]),\r\n  mainId: null\r\n})\r\n\r\nfunction normalizeCardDisplay(rows) {\r\n  const safeRows = Array.isArray(rows) ? rows : []\r\n  const normalized = safeRows.slice(0, 2).map(row => sanitizeFieldValues(Array.isArray(row) ? row : []))\r\n  while (normalized.length < 2) normalized.push([])\r\n  return normalized\r\n}\r\n\r\nfunction cloneCardDisplay(cardDisplay, fallbackRows = DEFAULT_CARD_DISPLAY) {\r\n  let source = cardDisplay\r\n  if (cardDisplay && !Array.isArray(cardDisplay) && typeof cardDisplay === 'object') {\r\n    source = [\r\n      cardDisplay[0] ?? cardDisplay['0'] ?? cardDisplay.row1 ?? cardDisplay.row_1 ?? cardDisplay.ligne1 ?? cardDisplay.line1 ?? cardDisplay.first ?? [],\r\n      cardDisplay[1] ?? cardDisplay['1'] ?? cardDisplay.row2 ?? cardDisplay.row_2 ?? cardDisplay.ligne2 ?? cardDisplay.line2 ?? cardDisplay.second ?? []\r\n    ]\r\n  }\r\n\r\n  if (!Array.isArray(source)) {\r\n    return fallbackRows.map(row => [...row])\r\n  }\r\n\r\n  const normalized = normalizeCardDisplay(source)\r\n  return normalized.map((row, index) => {\r\n    if (row.length) return [...row]\r\n    const fallback = fallbackRows[index]\r\n    return Array.isArray(fallback) ? [...fallback] : []\r\n  })\r\n}\r\n\r\nfunction buildChartConfig(overrides = {}) {\r\n  const base = {\r\n    transitionTime: DEFAULT_CHART_CONFIG.transitionTime,\r\n    cardXSpacing: DEFAULT_CHART_CONFIG.cardXSpacing,\r\n    cardYSpacing: DEFAULT_CHART_CONFIG.cardYSpacing,\r\n    orientation: DEFAULT_CHART_CONFIG.orientation,\r\n    showSiblingsOfMain: DEFAULT_CHART_CONFIG.showSiblingsOfMain,\r\n    singleParentEmptyCard: DEFAULT_CHART_CONFIG.singleParentEmptyCard,\r\n    singleParentEmptyCardLabel: DEFAULT_CHART_CONFIG.singleParentEmptyCardLabel,\r\n    ancestryDepth: DEFAULT_CHART_CONFIG.ancestryDepth,\r\n    progenyDepth: DEFAULT_CHART_CONFIG.progenyDepth,\r\n    miniTree: DEFAULT_CHART_CONFIG.miniTree,\r\n    duplicateBranchToggle: DEFAULT_CHART_CONFIG.duplicateBranchToggle,\r\n    editableFields: [...DEFAULT_EDITABLE_FIELDS],\r\n    cardDisplay: cloneCardDisplay(DEFAULT_CARD_DISPLAY),\r\n    mainId: DEFAULT_CHART_CONFIG.mainId\r\n  }\r\n\r\n  if (typeof overrides.transitionTime === 'number' && Number.isFinite(overrides.transitionTime)) {\r\n    base.transitionTime = overrides.transitionTime\r\n  }\r\n\r\n  if (typeof overrides.cardXSpacing === 'number' && Number.isFinite(overrides.cardXSpacing)) {\r\n    base.cardXSpacing = overrides.cardXSpacing\r\n  }\r\n\r\n  if (typeof overrides.cardYSpacing === 'number' && Number.isFinite(overrides.cardYSpacing)) {\r\n    base.cardYSpacing = overrides.cardYSpacing\r\n  }\r\n\r\n  if (overrides.orientation === 'horizontal' || overrides.orientation === 'vertical') {\r\n    base.orientation = overrides.orientation\r\n  }\r\n\r\n  if (typeof overrides.showSiblingsOfMain === 'boolean') {\r\n    base.showSiblingsOfMain = overrides.showSiblingsOfMain\r\n  }\r\n\r\n  if (typeof overrides.singleParentEmptyCard === 'boolean') {\r\n    base.singleParentEmptyCard = overrides.singleParentEmptyCard\r\n  }\r\n\r\n  if (typeof overrides.singleParentEmptyCardLabel === 'string') {\r\n    const trimmed = overrides.singleParentEmptyCardLabel.trim()\r\n    if (trimmed) base.singleParentEmptyCardLabel = trimmed\r\n  }\r\n\r\n  if (overrides.ancestryDepth === null) {\r\n    base.ancestryDepth = null\r\n  } else if (typeof overrides.ancestryDepth === 'number' && Number.isFinite(overrides.ancestryDepth) && overrides.ancestryDepth >= 0) {\r\n    base.ancestryDepth = Math.floor(overrides.ancestryDepth)\r\n  }\r\n\r\n  if (overrides.progenyDepth === null) {\r\n    base.progenyDepth = null\r\n  } else if (typeof overrides.progenyDepth === 'number' && Number.isFinite(overrides.progenyDepth) && overrides.progenyDepth >= 0) {\r\n    base.progenyDepth = Math.floor(overrides.progenyDepth)\r\n  }\r\n\r\n  if (typeof overrides.miniTree === 'boolean') {\r\n    base.miniTree = overrides.miniTree\r\n  }\r\n\r\n  if (typeof overrides.duplicateBranchToggle === 'boolean') {\r\n    base.duplicateBranchToggle = overrides.duplicateBranchToggle\r\n  }\r\n\r\n  if (Array.isArray(overrides.editableFields)) {\r\n    const sanitizedEditable = sanitizeFieldValues(overrides.editableFields)\r\n    if (sanitizedEditable.length) {\r\n      base.editableFields = sanitizedEditable\r\n    }\r\n  }\r\n\r\n  if (Array.isArray(overrides.cardDisplay) || (overrides.cardDisplay && typeof overrides.cardDisplay === 'object')) {\r\n    base.cardDisplay = cloneCardDisplay(overrides.cardDisplay, [[], []])\r\n  }\r\n\r\n  if (typeof overrides.mainId === 'string') {\r\n    const trimmed = overrides.mainId.trim()\r\n    if (trimmed) base.mainId = trimmed\r\n  }\r\n\r\n  return base\r\n}\r\n\r\nlet editTreeInstance = null\r\nlet autoSaveTimer = null\r\nlet lastSnapshotString = null\r\nlet isSaving = false\r\nlet queuedSave = null\r\nlet chartConfig = buildChartConfig()\r\nlet isApplyingConfig = false\r\nlet currentEditableFields = [...DEFAULT_EDITABLE_FIELDS]\r\nlet activePanelTeardown = null\r\n\r\nfunction setStatus(message, type = 'info') {\r\n  if (!statusEl) return\r\n  statusEl.textContent = message\r\n  statusEl.dataset.status = type\r\n}\r\n\r\nfunction normaliseTreePayload(payload) {\r\n  if (Array.isArray(payload)) {\r\n    return { data: payload, config: {} }\r\n  }\r\n\r\n  if (payload && typeof payload === 'object') {\r\n    if (Array.isArray(payload.data)) {\r\n      const candidateConfig = payload.config || payload.settings || payload.meta || {}\r\n      return { data: payload.data, config: candidateConfig }\r\n    }\r\n\r\n    if (Array.isArray(payload.tree)) {\r\n      const candidateConfig = payload.config || payload.settings || payload.meta || {}\r\n      return { data: payload.tree, config: candidateConfig }\r\n    }\r\n  }\r\n\r\n  return { data: [], config: {} }\r\n}\r\n\r\nfunction normaliseChartConfig(rawConfig = {}) {\r\n  if (!rawConfig || typeof rawConfig !== 'object') return {}\r\n\r\n  const config = {}\r\n\r\n  const transition = rawConfig.transitionTime ?? rawConfig.transition_time\r\n  if (typeof transition === 'number' && Number.isFinite(transition)) {\r\n    config.transitionTime = transition\r\n  }\r\n\r\n  const cardX = rawConfig.cardXSpacing ?? rawConfig.card_x_spacing ?? rawConfig.node_separation\r\n  if (typeof cardX === 'number' && Number.isFinite(cardX)) {\r\n    config.cardXSpacing = cardX\r\n  }\r\n\r\n  const cardY = rawConfig.cardYSpacing ?? rawConfig.card_y_spacing ?? rawConfig.level_separation\r\n  if (typeof cardY === 'number' && Number.isFinite(cardY)) {\r\n    config.cardYSpacing = cardY\r\n  }\r\n\r\n  const orientation = rawConfig.orientation\r\n  if (orientation === 'horizontal' || orientation === 'vertical') {\r\n    config.orientation = orientation\r\n  } else if (typeof rawConfig.is_horizontal === 'boolean') {\r\n    config.orientation = rawConfig.is_horizontal ? 'horizontal' : 'vertical'\r\n  }\r\n\r\n  const showSiblings = rawConfig.showSiblingsOfMain ?? rawConfig.show_siblings_of_main\r\n  if (typeof showSiblings === 'boolean') {\r\n    config.showSiblingsOfMain = showSiblings\r\n  }\r\n\r\n  const singleParentEnabled = rawConfig.singleParentEmptyCard ?? rawConfig.single_parent_empty_card\r\n  if (typeof singleParentEnabled === 'boolean') {\r\n    config.singleParentEmptyCard = singleParentEnabled\r\n  }\r\n\r\n  const emptyLabel = rawConfig.singleParentEmptyCardLabel ?? rawConfig.single_parent_empty_card_label\r\n  if (typeof emptyLabel === 'string' && emptyLabel.trim().length > 0) {\r\n    config.singleParentEmptyCardLabel = emptyLabel.trim()\r\n  }\r\n\r\n  const editableFields = rawConfig.editableFields ?? rawConfig.edit_fields ?? rawConfig.fields ?? rawConfig.editable_fields\r\n  if (Array.isArray(editableFields)) {\r\n    config.editableFields = sanitizeFieldValues(editableFields)\r\n  }\r\n\r\n  const rawCardDisplay = rawConfig.cardDisplay ?? rawConfig.card_display\r\n  if (Array.isArray(rawCardDisplay) || (rawCardDisplay && typeof rawCardDisplay === 'object')) {\r\n    config.cardDisplay = cloneCardDisplay(rawCardDisplay, [[], []])\r\n  }\r\n\r\n  const rawMainId = rawConfig.mainId ?? rawConfig.main_id ?? rawConfig.mainPersonId ?? rawConfig.main_person_id\r\n  if (typeof rawMainId === 'string' && rawMainId.trim().length > 0) {\r\n    config.mainId = rawMainId.trim()\r\n  }\r\n\r\n  const rawAncestryDepth = rawConfig.ancestryDepth ?? rawConfig.ancestry_depth\r\n  if (rawAncestryDepth === null) {\r\n    config.ancestryDepth = null\r\n  } else if (rawAncestryDepth !== undefined) {\r\n    const value = Number(rawAncestryDepth)\r\n    if (Number.isFinite(value) && value >= 0) {\r\n      config.ancestryDepth = Math.floor(value)\r\n    }\r\n  }\r\n\r\n  const rawProgenyDepth = rawConfig.progenyDepth ?? rawConfig.progeny_depth\r\n  if (rawProgenyDepth === null) {\r\n    config.progenyDepth = null\r\n  } else if (rawProgenyDepth !== undefined) {\r\n    const value = Number(rawProgenyDepth)\r\n    if (Number.isFinite(value) && value >= 0) {\r\n      config.progenyDepth = Math.floor(value)\r\n    }\r\n  }\r\n\r\n  const rawMiniTree = rawConfig.miniTree ?? rawConfig.mini_tree\r\n  if (typeof rawMiniTree === 'boolean') {\r\n    config.miniTree = rawMiniTree\r\n  }\r\n\r\n  const rawDuplicateToggle = rawConfig.duplicateBranchToggle ?? rawConfig.duplicate_branch_toggle\r\n  if (typeof rawDuplicateToggle === 'boolean') {\r\n    config.duplicateBranchToggle = rawDuplicateToggle\r\n  }\r\n\r\n  return config\r\n}\r\n\r\nfunction applyChartConfigToChart(chart) {\r\n  chart.setTransitionTime(chartConfig.transitionTime)\r\n  chart.setCardXSpacing(chartConfig.cardXSpacing)\r\n  chart.setCardYSpacing(chartConfig.cardYSpacing)\r\n  chart.setShowSiblingsOfMain(chartConfig.showSiblingsOfMain)\r\n\r\n  if (chartConfig.orientation === 'horizontal') {\r\n    chart.setOrientationHorizontal()\r\n  } else {\r\n    chart.setOrientationVertical()\r\n  }\r\n\r\n  chart.setSingleParentEmptyCard(chartConfig.singleParentEmptyCard, {\r\n    label: chartConfig.singleParentEmptyCardLabel\r\n  })\r\n\r\n  if (typeof chartConfig.ancestryDepth === 'number' && Number.isFinite(chartConfig.ancestryDepth)) {\r\n    chart.setAncestryDepth(chartConfig.ancestryDepth)\r\n  } else {\r\n    chart.setAncestryDepth(null)\r\n  }\r\n\r\n  if (typeof chartConfig.progenyDepth === 'number' && Number.isFinite(chartConfig.progenyDepth)) {\r\n    chart.setProgenyDepth(chartConfig.progenyDepth)\r\n  } else {\r\n    chart.setProgenyDepth(null)\r\n  }\r\n\r\n  chart.setDuplicateBranchToggle(chartConfig.duplicateBranchToggle !== false)\r\n}\r\n\r\nasync function loadTree() {\r\n  setStatus('Chargement des donn\u00E9es\u2026')\r\n  const response = await fetch('/api/tree', { cache: 'no-store' })\r\n  if (!response.ok) {\r\n    throw new Error(`\u00C9chec du chargement (${response.status})`)\r\n  }\r\n  return response.json()\r\n}\r\n\r\nfunction destroyTimer() {\r\n  if (autoSaveTimer) {\r\n    clearTimeout(autoSaveTimer)\r\n    autoSaveTimer = null\r\n  }\r\n}\r\n\r\nasync function persistChanges(snapshot, { immediate = false } = {}) {\r\n  if (!snapshot) return\r\n  destroyTimer()\r\n\r\n  const payload = structuredCloneSafe(snapshot)\r\n\r\n  if (isSaving) {\r\n    queuedSave = { snapshot: payload, immediate }\r\n    setStatus('Sauvegarde d\u00E9j\u00E0 en cours\u2026', 'saving')\r\n    return\r\n  }\r\n\r\n  try {\r\n    isSaving = true\r\n    setStatus(immediate ? 'Enregistrement en cours\u2026' : 'Sauvegarde automatique\u2026', 'saving')\r\n\r\n    const response = await fetch('/api/tree', {\r\n      method: 'PUT',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify(payload, null, 2)\r\n    })\r\n\r\n    if (!response.ok && response.status !== 204) {\r\n      throw new Error(`Serveur a retourn\u00E9 ${response.status}`)\r\n    }\r\n\r\n    lastSnapshotString = JSON.stringify(payload)\r\n    setStatus('Modifications enregistr\u00E9es \u2705', 'success')\r\n  } catch (error) {\r\n    console.error(error)\r\n    setStatus(`Erreur d'enregistrement: ${error.message}`, 'error')\r\n  } finally {\r\n    isSaving = false\r\n    if (queuedSave) {\r\n      const next = queuedSave\r\n      queuedSave = null\r\n      await persistChanges(next.snapshot, { immediate: next.immediate })\r\n    }\r\n  }\r\n}\r\n\r\nfunction structuredCloneSafe(value) {\r\n  if (typeof structuredClone === 'function') {\r\n    return structuredClone(value)\r\n  }\r\n  return JSON.parse(JSON.stringify(value))\r\n}\r\n\r\nfunction getSnapshot() {\r\n  if (!editTreeInstance) return null\r\n  const data = editTreeInstance.exportData()\r\n  if (!data) return null\r\n  return {\r\n    data,\r\n    config: structuredCloneSafe(chartConfig)\r\n  }\r\n}\r\n\r\nfunction scheduleAutoSave() {\r\n  destroyTimer()\r\n  setStatus('Modification d\u00E9tect\u00E9e\u2026 sauvegarde automatique imminente', 'saving')\r\n  autoSaveTimer = setTimeout(() => {\r\n    const snapshot = getSnapshot()\r\n    if (!snapshot) return\r\n    persistChanges(snapshot)\r\n  }, 1500)\r\n}\r\n\r\nfunction setupChart(payload) {\r\n  const container = document.querySelector(chartSelector)\r\n  if (!container) {\r\n    throw new Error('Conteneur du graphique introuvable')\r\n  }\r\n\r\n  container.innerHTML = ''\r\n\r\n  if (typeof activePanelTeardown === 'function') {\r\n    activePanelTeardown()\r\n    activePanelTeardown = null\r\n  }\r\n\r\n  const { data, config } = normaliseTreePayload(payload)\r\n  chartConfig = buildChartConfig(normaliseChartConfig(config))\r\n  currentEditableFields = [...chartConfig.editableFields]\r\n  if (!currentEditableFields.length) {\r\n    currentEditableFields = [...DEFAULT_EDITABLE_FIELDS]\r\n  }\r\n\r\n  const initialEditableFields = [...currentEditableFields]\r\n  const initialFieldDescriptors = buildFieldDescriptors(initialEditableFields)\r\n\r\n  const chart = f3.createChart(chartSelector, data)\r\n  applyChartConfigToChart(chart)\r\n\r\n  const initialCardDisplay = chartConfig.cardDisplay && chartConfig.cardDisplay.length\r\n    ? chartConfig.cardDisplay.map(row => [...row])\r\n    : cloneCardDisplay(DEFAULT_CARD_DISPLAY)\r\n\r\n  const card = chart.setCardHtml()\r\n    .setCardDisplay(initialCardDisplay)\r\n    .setCardImageField('avatar')\r\n    .setMiniTree(chartConfig.miniTree !== false)\r\n\r\n  let panelControlAPI = null\r\n  const dataArray = Array.isArray(data) ? data : []\r\n\r\n  editTreeInstance = chart.editTree()\r\n    .setFields(initialFieldDescriptors)\r\n    .setEditFirst(true)\r\n    .setCardClickOpen(card)\r\n    .setOnChange(() => {\r\n      lastSnapshotString = null\r\n      if (panelControlAPI) {\r\n        panelControlAPI.refreshMainProfileOptions({ keepSelection: true })\r\n        panelControlAPI.syncMainProfileSelection({ scheduleSaveIfChanged: false })\r\n      }\r\n      scheduleAutoSave()\r\n    })\r\n\r\n  panelControlAPI = attachPanelControls({ chart, card }) || {\r\n    refreshMainProfileOptions: () => {},\r\n    syncMainProfileSelection: () => {},\r\n    handleFormCreation: () => {},\r\n    teardown: () => {}\r\n  }\r\n\r\n  if (typeof panelControlAPI.teardown === 'function') {\r\n    activePanelTeardown = panelControlAPI.teardown\r\n  } else {\r\n    activePanelTeardown = null\r\n  }\r\n\r\n  if (typeof panelControlAPI.handleFormCreation === 'function') {\r\n    editTreeInstance.setOnFormCreation(panelControlAPI.handleFormCreation)\r\n  }\r\n\r\n  const initialMainId = resolveInitialMainId(dataArray, chart)\r\n  if (initialMainId) {\r\n    chart.updateMainId(initialMainId)\r\n  }\r\n\r\n  chart.setAfterUpdate(() => {\r\n    if (!chart.store || typeof chart.store.getMainId !== 'function') return\r\n    const storeMainId = chart.store.getMainId()\r\n    if (!storeMainId) return\r\n    if (chartConfig.mainId !== storeMainId) {\r\n      chartConfig = { ...chartConfig, mainId: storeMainId }\r\n      lastSnapshotString = null\r\n      if (!isApplyingConfig) {\r\n        scheduleAutoSave()\r\n      }\r\n    }\r\n    if (panelControlAPI) {\r\n      panelControlAPI.syncMainProfileSelection({ scheduleSaveIfChanged: false })\r\n    }\r\n  })\r\n\r\n  if (panelControlAPI) {\r\n    panelControlAPI.refreshMainProfileOptions({ keepSelection: false })\r\n    panelControlAPI.syncMainProfileSelection({ scheduleSaveIfChanged: false })\r\n  }\r\n\r\n  chart.updateTree({ initial: true, tree_position: 'fit' })\r\n\r\n  const mainDatum = chart.getMainDatum()\r\n  if (mainDatum) {\r\n    editTreeInstance.open(mainDatum)\r\n  }\r\n\r\n  const initialSnapshot = getSnapshot()\r\n  lastSnapshotString = initialSnapshot ? JSON.stringify(initialSnapshot) : null\r\n  const totalPersons = dataArray.length\r\n  setStatus(totalPersons > 0 ? `\u00C9diteur pr\u00EAt \u2705 \u2013 ${totalPersons} personne(s) charg\u00E9e(s)` : 'Fichier de donn\u00E9es vide', totalPersons > 0 ? 'success' : 'error')\r\n\r\n  function resolveInitialMainId(persons, chartInstance) {\r\n    if (!Array.isArray(persons) || persons.length === 0) {\r\n      chartConfig = { ...chartConfig, mainId: null }\r\n      return null\r\n    }\r\n\r\n    const availableIds = new Set(persons.map(person => person && person.id).filter(Boolean))\r\n    const desiredId = typeof chartConfig.mainId === 'string' ? chartConfig.mainId.trim() : ''\r\n    if (desiredId && availableIds.has(desiredId)) {\r\n      return desiredId\r\n    }\r\n\r\n    const storeMainId = chartInstance?.store && typeof chartInstance.store.getMainId === 'function'\r\n      ? chartInstance.store.getMainId()\r\n      : null\r\n\r\n    if (storeMainId && availableIds.has(storeMainId)) {\r\n      if (chartConfig.mainId !== storeMainId) {\r\n        chartConfig = { ...chartConfig, mainId: storeMainId }\r\n      }\r\n      return storeMainId\r\n    }\r\n\r\n    const fallbackId = persons[0]?.id || null\r\n    if (fallbackId && chartConfig.mainId !== fallbackId) {\r\n      chartConfig = { ...chartConfig, mainId: fallbackId }\r\n    }\r\n    return fallbackId\r\n  }\r\n}\r\n\r\nfunction attachPanelControls({ chart, card }) {\r\n  if (!panel) {\r\n    return {\r\n      refreshMainProfileOptions: () => {},\r\n      syncMainProfileSelection: () => {},\r\n      handleFormCreation: () => {},\r\n      teardown: () => {}\r\n    }\r\n  }\r\n\r\n  const editableFieldset = panel.querySelector('[data-role=\"editable-fields\"]')\r\n  const editableList = editableFieldset?.querySelector('.editable-list')\r\n  const addEditableBtn = editableFieldset?.querySelector('[data-action=\"add-editable\"]')\r\n  const displayGroups = [...panel.querySelectorAll('[data-display-row]')]\r\n  const displayGroupMap = new Map(displayGroups.map(group => [group.dataset.displayRow, group]))\r\n  const fieldLabelStore = createBaseFieldLabelStore()\r\n\r\n  const displayDefaultsByRow = new Map(\r\n    Object.entries(DISPLAY_DEFAULTS).map(([row, defs]) => [\r\n      row,\r\n      new Map(defs.map(def => [normalizeFieldKey(def.value), def.checked]))\r\n    ])\r\n  )\r\n\r\n  const imageField = panel.querySelector('#imageField')\r\n  const cardStyle = panel.querySelector('#cardStyle')\r\n  const transitionInput = panel.querySelector('#transitionInput')\r\n  const cardYSpacing = panel.querySelector('#cardYSpacing')\r\n  const cardXSpacing = panel.querySelector('#cardXSpacing')\r\n  const emptyLabel = panel.querySelector('#emptyLabel')\r\n  const ancestryDepthSelect = panel.querySelector('#ancestryDepth')\r\n  const progenyDepthSelect = panel.querySelector('#progenyDepth')\r\n  const miniTreeToggle = panel.querySelector('#miniTreeToggle')\r\n  const duplicateToggle = panel.querySelector('#duplicateToggle')\r\n  const orientationButtons = panel.querySelectorAll('[data-orientation]')\r\n  const cardWidth = panel.querySelector('#cardWidth')\r\n  const cardHeight = panel.querySelector('#cardHeight')\r\n  const imgWidth = panel.querySelector('#imgWidth')\r\n  const imgHeight = panel.querySelector('#imgHeight')\r\n  const imgX = panel.querySelector('#imgX')\r\n  const imgY = panel.querySelector('#imgY')\r\n  const resetDimensions = panel.querySelector('#resetDimensions')\r\n  const mainProfileFieldset = panel.querySelector('[data-role=\"main-profile\"]')\r\n  const mainProfileSelect = mainProfileFieldset?.querySelector('#mainProfileSelect')\r\n  const mainProfileName = mainProfileFieldset?.querySelector('[data-role=\"main-profile-name\"]')\r\n  if (mainProfileSelect) mainProfileSelect.disabled = true\r\n  const imageUploader = panel.querySelector('[data-role=\"image-uploader\"]')\r\n  const assetUploadInput = imageUploader?.querySelector('#assetUpload')\r\n  const assetUploadFeedback = imageUploader?.querySelector('[data-role=\"upload-feedback\"]')\r\n  const assetUploadResult = imageUploader?.querySelector('[data-role=\"upload-result\"]')\r\n  const assetUploadUrlOutput = imageUploader?.querySelector('[data-role=\"upload-url\"]')\r\n  const assetUploadOpenLink = imageUploader?.querySelector('[data-role=\"open-upload\"]')\r\n  const copyUploadUrlBtn = imageUploader?.querySelector('[data-action=\"copy-upload-url\"]')\r\n  const manualUrlInput = imageUploader?.querySelector('#assetUrl')\r\n  const copyManualUrlBtn = imageUploader?.querySelector('[data-action=\"copy-manual-url\"]')\r\n\r\n  const imageUploaderHome = imageUploader ? {\r\n    parent: imageUploader.parentElement,\r\n    nextSibling: imageUploader.nextSibling\r\n  } : null\r\n\r\n  let imageUploaderCurrentForm = null\r\n  let imageUploaderCurrentDatumId = null\r\n\r\n  function getActiveImageFieldId() {\r\n    const value = imageField?.value?.trim()\r\n    return value || 'avatar'\r\n  }\r\n\r\n  function getActiveDatum() {\r\n    if (!imageUploaderCurrentDatumId || !editTreeInstance?.store?.getDatum) return null\r\n    try {\r\n      return editTreeInstance.store.getDatum(imageUploaderCurrentDatumId) || null\r\n    } catch (error) {\r\n      console.error('Impossible de r\u00E9cup\u00E9rer le profil actif pour le t\u00E9l\u00E9versement', error)\r\n      return null\r\n    }\r\n  }\r\n\r\n  function normaliseUrl(rawUrl) {\r\n    if (!rawUrl) return ''\r\n    try {\r\n      return new URL(rawUrl, window.location.origin).toString()\r\n    } catch (error) {\r\n      return String(rawUrl)\r\n    }\r\n  }\r\n\r\n  function applyImageToActiveProfile(rawUrl, { origin = 'manual', sizeBytes } = {}) {\r\n    const absoluteUrl = normaliseUrl(rawUrl)\r\n    if (!absoluteUrl) return\r\n\r\n    const targetFieldId = getActiveImageFieldId()\r\n    const escapedFieldId = targetFieldId.replace(/\"/g, '\\\\\"')\r\n    let formUpdated = false\r\n    let datumUpdated = false\r\n\r\n    if (imageUploaderCurrentForm) {\r\n      const targetInput = imageUploaderCurrentForm.querySelector(`[name=\"${escapedFieldId}\"]`)\r\n      if (targetInput && targetInput instanceof HTMLInputElement) {\r\n        if (targetInput.value !== absoluteUrl) {\r\n          targetInput.value = absoluteUrl\r\n          targetInput.dispatchEvent(new Event('input', { bubbles: true }))\r\n        }\r\n        formUpdated = true\r\n      } else if (targetInput && targetInput instanceof HTMLTextAreaElement) {\r\n        if (targetInput.value !== absoluteUrl) {\r\n          targetInput.value = absoluteUrl\r\n          targetInput.dispatchEvent(new Event('input', { bubbles: true }))\r\n        }\r\n        formUpdated = true\r\n      }\r\n    }\r\n\r\n    const activeDatum = getActiveDatum()\r\n    if (activeDatum) {\r\n      if (!activeDatum.data) activeDatum.data = {}\r\n      if (activeDatum.data[targetFieldId] !== absoluteUrl) {\r\n        activeDatum.data[targetFieldId] = absoluteUrl\r\n        datumUpdated = true\r\n      }\r\n    }\r\n\r\n    if (datumUpdated) {\r\n      try {\r\n        chart.updateTree({ initial: false, tree_position: 'inherit' })\r\n      } catch (error) {\r\n        console.error('Impossible de rafra\u00EEchir le graphique apr\u00E8s mise \u00E0 jour de l\u2019image', error)\r\n      }\r\n      scheduleAutoSave()\r\n    }\r\n\r\n    if (manualUrlInput) manualUrlInput.value = absoluteUrl\r\n\r\n    const appliedSomewhere = formUpdated || datumUpdated\r\n    if (origin === 'upload') {\r\n      if (appliedSomewhere) {\r\n        const sizeMessage = sizeBytes ? ` (${formatBytes(sizeBytes)})` : ''\r\n        setUploadFeedback(`Image t\u00E9l\u00E9vers\u00E9e${sizeMessage} et appliqu\u00E9e au profil.`, 'success')\r\n        setStatus('Image appliqu\u00E9e au profil \u2705', 'success')\r\n      } else {\r\n        const sizeMessage = sizeBytes ? ` (${formatBytes(sizeBytes)})` : ''\r\n        setUploadFeedback(`Image t\u00E9l\u00E9vers\u00E9e${sizeMessage}. S\u00E9lectionnez un profil \u00E9ditable pour l\u2019appliquer.`, 'info')\r\n      }\r\n    } else if (appliedSomewhere) {\r\n      setUploadFeedback('Image appliqu\u00E9e au profil.', 'success')\r\n      setStatus('Image appliqu\u00E9e au profil \u2705', 'success')\r\n    } else {\r\n      setUploadFeedback('S\u00E9lectionnez un profil \u00E9ditable pour appliquer l\u2019image.', 'info')\r\n    }\r\n  }\r\n\r\n  function populateUploaderFromDatum() {\r\n    const targetFieldId = getActiveImageFieldId()\r\n    const activeDatum = getActiveDatum()\r\n    const existingValue = activeDatum?.data?.[targetFieldId] || ''\r\n\r\n    if (!existingValue) {\r\n      clearUploadResult()\r\n      if (manualUrlInput) manualUrlInput.value = ''\r\n      setUploadFeedback('Formats recommand\u00E9s : JPG, PNG, WebP.', 'info')\r\n      return\r\n    }\r\n\r\n    const absoluteUrl = showUploadResult(existingValue, { silent: true })\r\n    if (manualUrlInput) manualUrlInput.value = absoluteUrl\r\n    setUploadFeedback('Image actuelle du profil charg\u00E9e.', 'info')\r\n  }\r\n\r\n  function restoreImageUploaderToPanel() {\r\n    if (!imageUploader || !imageUploaderHome?.parent) return\r\n    if (imageUploaderCurrentForm) {\r\n      imageUploaderCurrentForm = null\r\n    }\r\n    imageUploaderCurrentDatumId = null\r\n    const { parent, nextSibling } = imageUploaderHome\r\n    if (nextSibling && parent.contains(nextSibling)) {\r\n      parent.insertBefore(imageUploader, nextSibling)\r\n    } else {\r\n      parent.appendChild(imageUploader)\r\n    }\r\n    imageUploader.classList.remove('is-modal-context')\r\n    clearUploadResult()\r\n    if (manualUrlInput) manualUrlInput.value = ''\r\n    setUploadFeedback('Importez une image ou collez une URL publique. Formats recommand\u00E9s : JPG, PNG, WebP.', 'info')\r\n  }\r\n\r\n  function injectImageUploaderIntoForm(form) {\r\n    if (!imageUploader || !form) return\r\n    if (imageUploaderCurrentForm === form) return\r\n\r\n    restoreImageUploaderToPanel()\r\n\r\n    const buttons = form.querySelector('.f3-form-buttons')\r\n    if (buttons && buttons.parentNode) {\r\n      buttons.parentNode.insertBefore(imageUploader, buttons)\r\n    } else {\r\n      form.appendChild(imageUploader)\r\n    }\r\n    imageUploader.classList.add('is-modal-context')\r\n    imageUploaderCurrentForm = form\r\n  }\r\n\r\n  function handleFormCreation({ cont, form_creator }) {\r\n    if (!imageUploader) return\r\n    const form = cont?.querySelector?.('form')\r\n    if (!form) {\r\n      restoreImageUploaderToPanel()\r\n      return\r\n    }\r\n\r\n    const isEditable = form_creator?.editable !== false && !form_creator?.no_edit\r\n    if (!isEditable) {\r\n      if (form.contains(imageUploader)) {\r\n        restoreImageUploaderToPanel()\r\n      }\r\n      return\r\n    }\r\n\r\n    injectImageUploaderIntoForm(form)\r\n    imageUploaderCurrentDatumId = form_creator?.datum_id || null\r\n    populateUploaderFromDatum()\r\n  }\r\n\r\n  function teardownImageUploader() {\r\n    restoreImageUploaderToPanel()\r\n  }\r\n\r\n  if (imageUploader && imageUploaderHome?.parent && imageUploader.parentElement !== imageUploaderHome.parent) {\r\n    restoreImageUploaderToPanel()\r\n  }\r\n\r\n  const MAX_UPLOAD_SIZE = 5 * 1024 * 1024\r\n\r\n  function formatBytes(bytes) {\r\n    if (!Number.isFinite(bytes)) return ''\r\n    if (bytes < 1024) return `${bytes} o`\r\n    if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} Ko`\r\n    return `${(bytes / (1024 * 1024)).toFixed(2)} Mo`\r\n  }\r\n\r\n  function setUploadFeedback(message, status = 'info') {\r\n    if (!assetUploadFeedback) return\r\n    assetUploadFeedback.textContent = message\r\n    assetUploadFeedback.dataset.status = status\r\n  }\r\n\r\n  function clearUploadResult() {\r\n    if (!assetUploadResult) return\r\n    assetUploadResult.classList.add('hidden')\r\n    assetUploadResult.dataset.url = ''\r\n    if (assetUploadUrlOutput) assetUploadUrlOutput.textContent = ''\r\n    if (assetUploadOpenLink) {\r\n      assetUploadOpenLink.href = '#'\r\n      assetUploadOpenLink.classList.add('hidden')\r\n    }\r\n  }\r\n\r\n  function showUploadResult(url, { silent = false } = {}) {\r\n    if (!assetUploadResult) return ''\r\n    const absoluteUrl = normaliseUrl(url)\r\n\r\n    assetUploadResult.dataset.url = absoluteUrl\r\n    if (assetUploadUrlOutput) assetUploadUrlOutput.textContent = absoluteUrl\r\n    if (assetUploadOpenLink) {\r\n      assetUploadOpenLink.href = absoluteUrl\r\n      assetUploadOpenLink.classList.remove('hidden')\r\n    }\r\n    assetUploadResult.classList.remove('hidden')\r\n    if (manualUrlInput) manualUrlInput.value = absoluteUrl\r\n    if (!silent) setUploadFeedback('Image pr\u00EAte \u00E0 \u00EAtre appliqu\u00E9e.', 'info')\r\n\r\n    return absoluteUrl\r\n  }\r\n\r\n  async function copyToClipboard(value, { successMessage = 'Copi\u00E9 dans le presse-papiers \u2705', errorMessage = 'Impossible de copier.' } = {}) {\r\n    if (!value) {\r\n      setUploadFeedback('Aucune URL \u00E0 copier.', 'error')\r\n      return\r\n    }\r\n    try {\r\n      if (navigator.clipboard?.writeText) {\r\n        await navigator.clipboard.writeText(value)\r\n      } else {\r\n        const temp = document.createElement('textarea')\r\n        temp.value = value\r\n        temp.setAttribute('readonly', '')\r\n        temp.style.position = 'absolute'\r\n        temp.style.left = '-9999px'\r\n        document.body.append(temp)\r\n        temp.select()\r\n        document.execCommand('copy')\r\n        temp.remove()\r\n      }\r\n      setStatus(successMessage, 'success')\r\n      setUploadFeedback(successMessage, 'success')\r\n    } catch (error) {\r\n      console.error(error)\r\n      setStatus(errorMessage, 'error')\r\n      setUploadFeedback(errorMessage, 'error')\r\n    }\r\n  }\r\n\r\n  async function handleFileUpload(file) {\r\n    if (!file) return\r\n    clearUploadResult()\r\n\r\n    if (!file.type || !file.type.startsWith('image/')) {\r\n      setUploadFeedback('Format non pris en charge. S\u00E9lectionnez une image (JPEG, PNG, WebP\u2026).', 'error')\r\n      return\r\n    }\r\n\r\n    if (file.size > MAX_UPLOAD_SIZE) {\r\n      setUploadFeedback(`Fichier trop volumineux (${formatBytes(file.size)}). Limite 5 Mo.`, 'error')\r\n      return\r\n    }\r\n\r\n    setUploadFeedback('T\u00E9l\u00E9versement en cours\u2026', 'saving')\r\n    setStatus('T\u00E9l\u00E9versement de l\u2019image\u2026', 'saving')\r\n\r\n    const formData = new FormData()\r\n    formData.append('file', file, file.name)\r\n\r\n    try {\r\n      const response = await fetch('/api/uploads', {\r\n        method: 'POST',\r\n        body: formData\r\n      })\r\n\r\n      if (!response.ok) {\r\n        let message = `Erreur serveur (${response.status})`\r\n        try {\r\n          const payload = await response.json()\r\n          if (payload?.message) message = payload.message\r\n        } catch (error) {\r\n          // ignore JSON parse errors\r\n        }\r\n        throw new Error(message)\r\n      }\r\n\r\n      const payload = await response.json()\r\n      const uploadedUrl = payload?.url\r\n      if (!uploadedUrl) {\r\n        throw new Error('R\u00E9ponse du serveur invalide (URL manquante).')\r\n      }\r\n\r\n      const absoluteUrl = showUploadResult(uploadedUrl)\r\n      applyImageToActiveProfile(absoluteUrl, { origin: 'upload', sizeBytes: file.size })\r\n    } catch (error) {\r\n      console.error(error)\r\n      setUploadFeedback(error.message || '\u00C9chec du t\u00E9l\u00E9versement.', 'error')\r\n      setStatus(`T\u00E9l\u00E9versement \u00E9chou\u00E9: ${error.message || 'Erreur inconnue'}`, 'error')\r\n      clearUploadResult()\r\n    }\r\n  }\r\n\r\n  clearUploadResult()\r\n  if (assetUploadFeedback) {\r\n    setUploadFeedback(assetUploadFeedback.textContent || 'Formats recommand\u00E9s : JPG, PNG, WebP.', 'info')\r\n  }\r\n\r\n  function setOrientationButtonsState(orientation) {\r\n    orientationButtons.forEach(button => {\r\n      const isActive = button.dataset.orientation === orientation\r\n      button.classList.toggle('active', isActive)\r\n    })\r\n  }\r\n\r\n  function refreshConfigControls() {\r\n    if (transitionInput) transitionInput.value = chartConfig.transitionTime?.toString() ?? ''\r\n    if (cardXSpacing) cardXSpacing.value = chartConfig.cardXSpacing?.toString() ?? ''\r\n    if (cardYSpacing) cardYSpacing.value = chartConfig.cardYSpacing?.toString() ?? ''\r\n    if (emptyLabel) {\r\n      const label = chartConfig.singleParentEmptyCardLabel ?? DEFAULT_CHART_CONFIG.singleParentEmptyCardLabel\r\n      emptyLabel.value = label\r\n    }\r\n    if (ancestryDepthSelect) ancestryDepthSelect.value = depthToSelectValue(chartConfig.ancestryDepth, DEFAULT_CHART_CONFIG.ancestryDepth)\r\n    if (progenyDepthSelect) progenyDepthSelect.value = depthToSelectValue(chartConfig.progenyDepth, DEFAULT_CHART_CONFIG.progenyDepth)\r\n    if (miniTreeToggle) miniTreeToggle.checked = chartConfig.miniTree !== false\r\n    if (duplicateToggle) duplicateToggle.checked = chartConfig.duplicateBranchToggle !== false\r\n    setOrientationButtonsState(chartConfig.orientation || DEFAULT_CHART_CONFIG.orientation)\r\n  }\r\n\r\n  function commitConfigUpdate(partialConfig = {}, { treePosition = 'inherit', refresh = true } = {}) {\r\n    chartConfig = { ...chartConfig, ...partialConfig }\r\n    applyChartConfigToChart(chart)\r\n    if (card && typeof card.setMiniTree === 'function') {\r\n      card.setMiniTree(chartConfig.miniTree !== false)\r\n    }\r\n    if (refresh) {\r\n      const prevState = isApplyingConfig\r\n      isApplyingConfig = true\r\n      refreshConfigControls()\r\n      isApplyingConfig = prevState\r\n    }\r\n    chart.updateTree({ initial: false, tree_position: treePosition })\r\n    lastSnapshotString = null\r\n    if (!isApplyingConfig) {\r\n      scheduleAutoSave()\r\n    }\r\n  }\r\n\r\n  function parseNumberInput(input, fallback) {\r\n    if (!input) return fallback\r\n    const value = Number(input.value)\r\n    return Number.isFinite(value) ? value : fallback\r\n  }\r\n\r\n  function depthToSelectValue(value, fallback) {\r\n    if (value === null) return ''\r\n    if (typeof value === 'number' && Number.isFinite(value) && value >= 0) {\r\n      return String(Math.floor(value))\r\n    }\r\n    if (typeof fallback === 'number' && Number.isFinite(fallback) && fallback >= 0) {\r\n      return String(Math.floor(fallback))\r\n    }\r\n    return ''\r\n  }\r\n\r\n  function parseDepthSelectValue(select, fallback) {\r\n    if (!select) return fallback\r\n    if (select.value === '') return null\r\n    const value = Number(select.value)\r\n    if (Number.isFinite(value) && value >= 0) {\r\n      return Math.floor(value)\r\n    }\r\n    return fallback\r\n  }\r\n\r\n  function ensureFieldLabel(value, label) {\r\n    const key = normalizeFieldKey(value)\r\n    if (label) {\r\n      fieldLabelStore.set(key, label.trim() || value)\r\n    } else if (!fieldLabelStore.has(key)) {\r\n      fieldLabelStore.set(key, value)\r\n    }\r\n    return fieldLabelStore.get(key) || value\r\n  }\r\n\r\n  function createFieldDescriptors(fieldValues) {\r\n    return sanitizeFieldValues(fieldValues).map(value => {\r\n      const key = normalizeFieldKey(value)\r\n      const label = ensureFieldLabel(value, fieldLabelStore.get(key))\r\n      const type = TEXTAREA_FIELD_KEYS.has(key) ? 'textarea' : 'text'\r\n      return { id: value, label, type }\r\n    })\r\n  }\r\n\r\n  function safeTrim(value) {\r\n    return typeof value === 'string' ? value.trim() : ''\r\n  }\r\n\r\n  function getAllPersons() {\r\n    if (!editTreeInstance || !editTreeInstance.store || typeof editTreeInstance.store.getData !== 'function') {\r\n      return []\r\n    }\r\n    const persons = editTreeInstance.store.getData()\r\n    return Array.isArray(persons) ? persons : []\r\n  }\r\n\r\n  function buildPersonLabel(datum) {\r\n    if (!datum) return 'Profil sans nom'\r\n    const person = datum.data || {}\r\n    const first = safeTrim(person['first name'])\r\n    const last = safeTrim(person['last name'])\r\n    const base = (first || last) ? [first, last].filter(Boolean).join(' ').trim() : `Profil ${datum.id}`\r\n    const birth = safeTrim(person['birthday'])\r\n    return birth ? `${base} (${birth})` : base\r\n  }\r\n\r\n  function updateMainProfileDisplay(id) {\r\n    if (!mainProfileName) return\r\n    if (!id) {\r\n      mainProfileName.textContent = '\u2014'\r\n      return\r\n    }\r\n    const datum = editTreeInstance?.store?.getDatum?.(id)\r\n    if (!datum) {\r\n      mainProfileName.textContent = '\u2014'\r\n      return\r\n    }\r\n    mainProfileName.textContent = buildPersonLabel(datum)\r\n  }\r\n\r\n  function refreshMainProfileOptions({ keepSelection = true } = {}) {\r\n    if (!mainProfileSelect) return\r\n    const persons = getAllPersons()\r\n    const previousValue = keepSelection ? mainProfileSelect.value : ''\r\n    mainProfileSelect.innerHTML = ''\r\n\r\n    if (!persons.length) {\r\n      const placeholder = document.createElement('option')\r\n      placeholder.value = ''\r\n      placeholder.textContent = 'Aucune personne disponible'\r\n      mainProfileSelect.append(placeholder)\r\n      mainProfileSelect.disabled = true\r\n      updateMainProfileDisplay(null)\r\n      return\r\n    }\r\n\r\n    const fragment = document.createDocumentFragment()\r\n    persons.forEach(datum => {\r\n      if (!datum || !datum.id) return\r\n      const option = document.createElement('option')\r\n      option.value = datum.id\r\n      option.textContent = buildPersonLabel(datum)\r\n      fragment.append(option)\r\n    })\r\n    mainProfileSelect.append(fragment)\r\n    mainProfileSelect.disabled = false\r\n\r\n    const availableIds = new Set(persons.map(d => d.id))\r\n    const preferred = []\r\n    if (keepSelection && previousValue && availableIds.has(previousValue)) preferred.push(previousValue)\r\n\r\n    const configMain = typeof chartConfig.mainId === 'string' ? chartConfig.mainId : ''\r\n    if (configMain && availableIds.has(configMain)) preferred.push(configMain)\r\n\r\n    const storeMainId = chart.store && typeof chart.store.getMainId === 'function' ? chart.store.getMainId() : ''\r\n    if (storeMainId && availableIds.has(storeMainId)) preferred.push(storeMainId)\r\n\r\n    if (persons[0]?.id) preferred.push(persons[0].id)\r\n\r\n    const targetValue = preferred.find(Boolean) || ''\r\n    if (targetValue) {\r\n      mainProfileSelect.value = targetValue\r\n    } else {\r\n      mainProfileSelect.selectedIndex = 0\r\n    }\r\n\r\n    updateMainProfileDisplay(mainProfileSelect.value || null)\r\n  }\r\n\r\n  function syncMainProfileSelection({ scheduleSaveIfChanged = false } = {}) {\r\n    if (!chart.store || typeof chart.store.getMainId !== 'function') {\r\n      return\r\n    }\r\n\r\n    const storeMainId = chart.store.getMainId()\r\n\r\n    if (mainProfileSelect) {\r\n      const persons = getAllPersons()\r\n      const availableIds = new Set(persons.map(d => d.id))\r\n\r\n      if (storeMainId && !availableIds.has(storeMainId)) {\r\n        refreshMainProfileOptions({ keepSelection: false })\r\n      }\r\n\r\n      if (storeMainId) {\r\n        const hasOption = [...mainProfileSelect.options].some(option => option.value === storeMainId)\r\n        if (!hasOption) {\r\n          refreshMainProfileOptions({ keepSelection: false })\r\n        }\r\n        mainProfileSelect.value = storeMainId\r\n        mainProfileSelect.disabled = false\r\n      }\r\n\r\n      if (!storeMainId && !mainProfileSelect.options.length) {\r\n        refreshMainProfileOptions({ keepSelection: false })\r\n      }\r\n    }\r\n\r\n    updateMainProfileDisplay(storeMainId || null)\r\n\r\n    if (chartConfig.mainId !== storeMainId) {\r\n      chartConfig = { ...chartConfig, mainId: storeMainId || null }\r\n      lastSnapshotString = null\r\n      if (scheduleSaveIfChanged && !isApplyingConfig) {\r\n        scheduleAutoSave()\r\n      }\r\n    }\r\n  }\r\n\r\n  function setMainProfile(id, { openEditor = true, treePosition = 'main_to_middle', suppressSave = false } = {}) {\r\n    if (!id) return\r\n    const persons = getAllPersons()\r\n    if (!persons.some(person => person.id === id)) {\r\n      refreshMainProfileOptions({ keepSelection: false })\r\n      return\r\n    }\r\n\r\n    const storeMainId = chart.store && typeof chart.store.getMainId === 'function' ? chart.store.getMainId() : null\r\n    const mainChanged = storeMainId !== id\r\n\r\n    if (mainChanged) {\r\n      chart.updateMainId(id)\r\n      chart.updateTree({ initial: false, tree_position: treePosition })\r\n    }\r\n\r\n    const configChanged = chartConfig.mainId !== id\r\n    if (configChanged) {\r\n      chartConfig = { ...chartConfig, mainId: id }\r\n    }\r\n\r\n    if ((configChanged || mainChanged) && !suppressSave) {\r\n      lastSnapshotString = null\r\n      if (!isApplyingConfig) {\r\n        scheduleAutoSave()\r\n      }\r\n    }\r\n\r\n    if (mainProfileSelect && mainProfileSelect.value !== id) {\r\n      mainProfileSelect.value = id\r\n      mainProfileSelect.disabled = false\r\n    }\r\n\r\n    updateMainProfileDisplay(id)\r\n\r\n    if (openEditor && editTreeInstance) {\r\n      const datum = editTreeInstance.store?.getDatum?.(id)\r\n      if (datum) editTreeInstance.open(datum)\r\n    }\r\n  }\r\n\r\n  if (mainProfileSelect) {\r\n    mainProfileSelect.addEventListener('change', event => {\r\n      const { value } = event.target\r\n      if (!value) return\r\n      setMainProfile(value, { openEditor: true, treePosition: 'main_to_middle' })\r\n    })\r\n  }\r\n\r\n  function escapeSelector(value) {\r\n    if (window.CSS?.escape) return window.CSS.escape(value)\r\n    return value.replace(/[^a-zA-Z0-9_-]/g, char => `\\\\${char}`)\r\n  }\r\n\r\n  function addRemoveButton(item) {\r\n    if (item.querySelector('.remove-field')) return\r\n    const removeBtn = document.createElement('button')\r\n    removeBtn.type = 'button'\r\n    removeBtn.className = 'remove-field'\r\n    removeBtn.textContent = 'Retirer'\r\n    removeBtn.addEventListener('click', () => {\r\n      item.remove()\r\n      updateCardDisplay()\r\n    })\r\n    item.append(removeBtn)\r\n  }\r\n\r\n  function removeDisplayFieldEntries(fieldKey) {\r\n    displayGroups.forEach(group => {\r\n      const list = group.querySelector('.field-list')\r\n      if (!list) return\r\n      const selector = `[data-field-key=\"${escapeSelector(fieldKey)}\"]`\r\n      const item = list.querySelector(selector)\r\n      if (!item) return\r\n\r\n      if (item.dataset.custom === 'true') {\r\n        item.remove()\r\n      } else {\r\n        const defaults = displayDefaultsByRow.get(group.dataset.displayRow)\r\n        const defaultChecked = defaults?.get(fieldKey)\r\n        const checkbox = item.querySelector('input[type=\"checkbox\"]')\r\n        if (checkbox && typeof defaultChecked === 'boolean') {\r\n          checkbox.checked = defaultChecked\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  function getDisplayRowsForField(field) {\r\n    if (!chartConfig.cardDisplay) return []\r\n    const key = normalizeFieldKey(field)\r\n    const rows = []\r\n    chartConfig.cardDisplay.forEach((row, index) => {\r\n      if (row.some(value => normalizeFieldKey(value) === key)) {\r\n        rows.push(String(index + 1))\r\n      }\r\n    })\r\n    return rows\r\n  }\r\n\r\n  function ensureConfigEditableItems() {\r\n    if (!Array.isArray(chartConfig.editableFields)) return\r\n    chartConfig.editableFields.forEach(field => {\r\n      const key = normalizeFieldKey(field)\r\n      if (!key) return\r\n      const label = ensureFieldLabel(field, fieldLabelStore.get(key))\r\n      const selector = `[data-field-key=\"${escapeSelector(key)}\"]`\r\n      if (editableList?.querySelector(selector)) return\r\n      createEditableItem({\r\n        value: field,\r\n        label,\r\n        checked: true,\r\n        removable: true,\r\n        selectRows: getDisplayRowsForField(field)\r\n      })\r\n    })\r\n  }\r\n\r\n  function applyConfigToEditableControls() {\r\n    if (!editableList) return\r\n    const desired = new Set((chartConfig.editableFields || []).map(normalizeFieldKey))\r\n    editableList.querySelectorAll('input[type=\"checkbox\"]').forEach(input => {\r\n      const key = normalizeFieldKey(input.value)\r\n      input.checked = desired.has(key)\r\n    })\r\n  }\r\n\r\n  function applyConfigToDisplayControls() {\r\n    displayGroups.forEach((group, index) => {\r\n      const desiredRow = (chartConfig.cardDisplay && chartConfig.cardDisplay[index]) || []\r\n      const desiredSet = new Set(desiredRow.map(normalizeFieldKey))\r\n      group.querySelectorAll('input[type=\"checkbox\"]').forEach(input => {\r\n        const key = normalizeFieldKey(input.value)\r\n        input.checked = desiredSet.has(key)\r\n      })\r\n    })\r\n  }\r\n\r\n  function createDisplayItem(group, { value, label, defaultChecked = false, removable = false }) {\r\n    const list = group.querySelector('.field-list')\r\n    if (!list) return { item: null, isNew: false }\r\n\r\n  const key = normalizeFieldKey(value)\r\n    const selector = `[data-field-key=\"${escapeSelector(key)}\"]`\r\n    const displayLabel = ensureFieldLabel(value, label)\r\n    let item = list.querySelector(selector)\r\n\r\n    if (item) {\r\n      const textEl = item.querySelector('label span')\r\n      if (textEl) textEl.textContent = displayLabel\r\n      if (removable) {\r\n        item.dataset.custom = 'true'\r\n        addRemoveButton(item)\r\n      }\r\n      return { item, isNew: false }\r\n    }\r\n\r\n    item = document.createElement('div')\r\n    item.className = 'display-item'\r\n    item.dataset.fieldKey = key\r\n    if (removable) item.dataset.custom = 'true'\r\n\r\n    const labelEl = document.createElement('label')\r\n    const checkbox = document.createElement('input')\r\n    checkbox.type = 'checkbox'\r\n    checkbox.value = value\r\n    checkbox.checked = defaultChecked\r\n\r\n    const textEl = document.createElement('span')\r\n    textEl.textContent = displayLabel\r\n\r\n    labelEl.append(checkbox, textEl)\r\n    item.append(labelEl)\r\n\r\n    if (removable) {\r\n      addRemoveButton(item)\r\n    }\r\n\r\n    list.append(item)\r\n    return { item, isNew: true }\r\n  }\r\n\r\n  function createEditableItem({ value, label, checked = true, removable = false, selectRows = [] }) {\r\n    if (!editableList) return\r\n\r\n    const key = normalizeFieldKey(value)\r\n    const displayLabel = ensureFieldLabel(value, label)\r\n    const selector = `[data-field-key=\"${escapeSelector(key)}\"]`\r\n    let item = editableList.querySelector(selector)\r\n    const isNew = !item\r\n\r\n    if (!item) {\r\n      item = document.createElement('div')\r\n      item.className = 'editable-item'\r\n      item.dataset.fieldKey = key\r\n      if (removable) item.dataset.custom = 'true'\r\n\r\n      const labelEl = document.createElement('label')\r\n      const checkbox = document.createElement('input')\r\n      checkbox.type = 'checkbox'\r\n      checkbox.value = value\r\n      checkbox.checked = checked\r\n\r\n      const textEl = document.createElement('span')\r\n      textEl.textContent = displayLabel\r\n\r\n      labelEl.append(checkbox, textEl)\r\n      item.append(labelEl)\r\n\r\n      if (removable) {\r\n        const removeBtn = document.createElement('button')\r\n        removeBtn.type = 'button'\r\n        removeBtn.className = 'remove-field'\r\n        removeBtn.textContent = 'Retirer'\r\n        removeBtn.addEventListener('click', () => {\r\n          item.remove()\r\n          removeDisplayFieldEntries(key)\r\n          applyEditableFields()\r\n        })\r\n        item.append(removeBtn)\r\n      }\r\n\r\n      editableList.append(item)\r\n    } else {\r\n      const checkbox = item.querySelector('input[type=\"checkbox\"]')\r\n      if (checkbox && typeof checked === 'boolean') checkbox.checked = checked\r\n      const textEl = item.querySelector('label span')\r\n      if (textEl) textEl.textContent = displayLabel\r\n      if (removable) item.dataset.custom = 'true'\r\n    }\r\n\r\n    const selectRowSet = new Set((selectRows || []).map(String))\r\n\r\n    displayGroups.forEach(group => {\r\n      const rowKey = group.dataset.displayRow\r\n      const defaults = displayDefaultsByRow.get(rowKey)\r\n      const defaultChecked = defaults?.get(key)\r\n      const shouldCheck = defaultChecked !== undefined ? defaultChecked : selectRowSet.has(rowKey)\r\n      const removableForGroup = removable\r\n      const { item: displayItem, isNew: created } = createDisplayItem(group, {\r\n        value,\r\n        label: displayLabel,\r\n        defaultChecked: shouldCheck,\r\n        removable: removableForGroup\r\n      })\r\n\r\n      if (!displayItem) return\r\n      if (!created && selectRowSet.has(rowKey)) {\r\n        const checkbox = displayItem.querySelector('input[type=\"checkbox\"]')\r\n        if (checkbox) checkbox.checked = true\r\n      }\r\n    })\r\n  }\r\n\r\n  function getSelectedValues(group) {\r\n    if (!group) return []\r\n    return [...group.querySelectorAll('input[type=\"checkbox\"]')]\r\n      .filter(input => input.checked)\r\n      .map(input => input.value)\r\n  }\r\n\r\n  function areFieldListsEqual(a = [], b = []) {\r\n    if (a.length !== b.length) return false\r\n    return a.every((value, index) => normalizeFieldKey(value) === normalizeFieldKey(b[index]))\r\n  }\r\n\r\n  function areCardDisplaysEqual(a = [], b = []) {\r\n    if (a.length !== b.length) return false\r\n    return a.every((row, index) => areFieldListsEqual(row, b[index]))\r\n  }\r\n\r\n  function syncDisplayItemsWithEditable(activeKeys) {\r\n    displayGroups.forEach(group => {\r\n      const items = group.querySelectorAll('.display-item')\r\n      items.forEach(item => {\r\n        const key = item.dataset.fieldKey\r\n        const checkbox = item.querySelector('input[type=\"checkbox\"]')\r\n        const isActive = activeKeys.has(key)\r\n        item.classList.toggle('is-disabled', !isActive)\r\n        if (!checkbox) return\r\n        checkbox.disabled = !isActive\r\n        if (!isActive && checkbox.checked) {\r\n          checkbox.checked = false\r\n        }\r\n      })\r\n    })\r\n  }\r\n\r\n  function updateCardDisplay({ suppressSave = false } = {}) {\r\n    const row1Group = displayGroupMap.get('1')\r\n    const row2Group = displayGroupMap.get('2')\r\n    const row1 = sanitizeFieldValues(getSelectedValues(row1Group))\r\n    const row2 = sanitizeFieldValues(getSelectedValues(row2Group))\r\n    const fallback = (row1[0])\r\n      || (currentEditableFields.length ? currentEditableFields[0] : (DEFAULT_EDITABLE_FIELDS[0] || 'first name'))\r\n    const appliedRow1 = row1.length ? row1 : [fallback]\r\n    const appliedRows = [appliedRow1, row2]\r\n\r\n    card.setCardDisplay(appliedRows)\r\n    chart.updateTree({ initial: false, tree_position: 'inherit' })\r\n\r\n    const displayChanged = !areCardDisplaysEqual(chartConfig.cardDisplay, appliedRows)\r\n    if (displayChanged) {\r\n      chartConfig = {\r\n        ...chartConfig,\r\n        cardDisplay: appliedRows.map(row => [...row])\r\n      }\r\n      if (!suppressSave) {\r\n        lastSnapshotString = null\r\n        if (!isApplyingConfig) scheduleAutoSave()\r\n      }\r\n    }\r\n  }\r\n\r\n  function applyEditableFields({ suppressSave = false } = {}) {\r\n    if (!editTreeInstance || !editableList) return\r\n    const values = [...editableList.querySelectorAll('input[type=\"checkbox\"]')]\r\n      .filter(input => input.checked)\r\n      .map(input => input.value)\r\n    let applied = values.length ? values : (chartConfig.editableFields.length ? [...chartConfig.editableFields] : ['first name'])\r\n    applied = sanitizeFieldValues(applied)\r\n    if (!applied.length) {\r\n      const fallbackField = DEFAULT_EDITABLE_FIELDS[0] || 'first name'\r\n      applied = [fallbackField]\r\n      if (editableList) {\r\n        const fallbackKey = normalizeFieldKey(fallbackField)\r\n        const selector = `[data-field-key=\"${escapeSelector(fallbackKey)}\"] input[type=\"checkbox\"]`\r\n        const fallbackInput = editableList.querySelector(selector)\r\n        if (fallbackInput) fallbackInput.checked = true\r\n      }\r\n    }\r\n\r\n    currentEditableFields = [...applied]\r\n    const fieldDescriptors = createFieldDescriptors(applied)\r\n    editTreeInstance.setFields(fieldDescriptors)\r\n\r\n    const activeKeys = new Set(applied.map(normalizeFieldKey))\r\n    syncDisplayItemsWithEditable(activeKeys)\r\n\r\n    const editableChanged = !areFieldListsEqual(chartConfig.editableFields, applied)\r\n    if (editableChanged) {\r\n      chartConfig = { ...chartConfig, editableFields: [...applied] }\r\n      if (!suppressSave) {\r\n        lastSnapshotString = null\r\n        if (!isApplyingConfig) scheduleAutoSave()\r\n      }\r\n    }\r\n\r\n    updateCardDisplay({ suppressSave })\r\n\r\n    const datum = editTreeInstance.store.getMainDatum()\r\n    if (datum) editTreeInstance.open(datum)\r\n  }\r\n\r\n  function requestFieldDefinition() {\r\n    const rawValue = prompt('Nom du champ (cl\u00E9 dans vos donn\u00E9es) ?')\r\n    if (!rawValue) return null\r\n    const value = rawValue.trim()\r\n    if (!value) return null\r\n\r\n  const key = normalizeFieldKey(value)\r\n    const suggestedLabel = fieldLabelStore.get(key) || value\r\n    const labelInput = prompt('Libell\u00E9 affich\u00E9 pour ce champ ?', suggestedLabel)\r\n    const displayLabel = (labelInput ?? suggestedLabel).trim() || value\r\n\r\n    return { value, label: displayLabel, key }\r\n  }\r\n\r\n  function handleAddEditableField({ selectRows = [] } = {}) {\r\n    const definition = requestFieldDefinition()\r\n    if (!definition) return\r\n    const { value, label, key } = definition\r\n  const isDefault = EDITABLE_DEFAULTS.some(def => normalizeFieldKey(def.value) === key)\r\n\r\n    createEditableItem({\r\n      value,\r\n      label,\r\n      checked: true,\r\n      removable: !isDefault,\r\n      selectRows\r\n    })\r\n\r\n    applyEditableFields()\r\n  }\r\n\r\n  EDITABLE_DEFAULTS.forEach(def => {\r\n    createEditableItem({\r\n      value: def.value,\r\n      label: def.label,\r\n      checked: def.checked !== false,\r\n      removable: false\r\n    })\r\n  })\r\n\r\n  editableList?.addEventListener('change', (event) => {\r\n    if (event.target.matches('input[type=\"checkbox\"]')) {\r\n      applyEditableFields()\r\n    }\r\n  })\r\n\r\n  addEditableBtn?.addEventListener('click', () => handleAddEditableField())\r\n\r\n  displayGroups.forEach(group => {\r\n    group.addEventListener('change', (event) => {\r\n      if (event.target.matches('input[type=\"checkbox\"]')) {\r\n        updateCardDisplay()\r\n      }\r\n    })\r\n  })\r\n\r\n  imageField?.addEventListener('change', () => {\r\n    card.setCardImageField(imageField.value)\r\n    chart.updateTree({ initial: false, tree_position: 'inherit' })\r\n    populateUploaderFromDatum()\r\n  })\r\n\r\n  cardStyle?.addEventListener('change', () => {\r\n    card.setStyle(cardStyle.value)\r\n    chart.updateTree({ initial: false, tree_position: 'inherit' })\r\n  })\r\n\r\n  transitionInput?.addEventListener('change', () => {\r\n    if (isApplyingConfig) return\r\n    const fallback = chartConfig.transitionTime ?? DEFAULT_CHART_CONFIG.transitionTime\r\n    const value = parseNumberInput(transitionInput, fallback)\r\n    const safeValue = Math.max(0, value)\r\n    if (safeValue === chartConfig.transitionTime) return\r\n    commitConfigUpdate({ transitionTime: safeValue })\r\n  })\r\n\r\n  cardYSpacing?.addEventListener('change', () => {\r\n    if (isApplyingConfig) return\r\n    const fallback = chartConfig.cardYSpacing ?? DEFAULT_CHART_CONFIG.cardYSpacing\r\n    const value = parseNumberInput(cardYSpacing, fallback)\r\n    const safeValue = value > 0 ? value : fallback\r\n    if (safeValue === chartConfig.cardYSpacing) return\r\n    commitConfigUpdate({ cardYSpacing: safeValue })\r\n  })\r\n\r\n  cardXSpacing?.addEventListener('change', () => {\r\n    if (isApplyingConfig) return\r\n    const fallback = chartConfig.cardXSpacing ?? DEFAULT_CHART_CONFIG.cardXSpacing\r\n    const value = parseNumberInput(cardXSpacing, fallback)\r\n    const safeValue = value > 0 ? value : fallback\r\n    if (safeValue === chartConfig.cardXSpacing) return\r\n    commitConfigUpdate({ cardXSpacing: safeValue })\r\n  })\r\n\r\n  ancestryDepthSelect?.addEventListener('change', () => {\r\n    if (isApplyingConfig) return\r\n    const fallback = chartConfig.ancestryDepth ?? DEFAULT_CHART_CONFIG.ancestryDepth ?? null\r\n    const value = parseDepthSelectValue(ancestryDepthSelect, fallback)\r\n    if (value === chartConfig.ancestryDepth) return\r\n    commitConfigUpdate({ ancestryDepth: value }, { treePosition: 'main_to_middle' })\r\n  })\r\n\r\n  progenyDepthSelect?.addEventListener('change', () => {\r\n    if (isApplyingConfig) return\r\n    const fallback = chartConfig.progenyDepth ?? DEFAULT_CHART_CONFIG.progenyDepth ?? null\r\n    const value = parseDepthSelectValue(progenyDepthSelect, fallback)\r\n    if (value === chartConfig.progenyDepth) return\r\n    commitConfigUpdate({ progenyDepth: value }, { treePosition: 'main_to_middle' })\r\n  })\r\n\r\n  miniTreeToggle?.addEventListener('change', () => {\r\n    if (isApplyingConfig) return\r\n    const enabled = miniTreeToggle.checked\r\n    const previous = chartConfig.miniTree !== false\r\n    if (enabled === previous) return\r\n    commitConfigUpdate({ miniTree: enabled })\r\n  })\r\n\r\n  duplicateToggle?.addEventListener('change', () => {\r\n    if (isApplyingConfig) return\r\n    const enabled = duplicateToggle.checked\r\n    const previous = chartConfig.duplicateBranchToggle !== false\r\n    if (enabled === previous) return\r\n    commitConfigUpdate({ duplicateBranchToggle: enabled }, { treePosition: 'inherit' })\r\n  })\r\n\r\n  emptyLabel?.addEventListener('change', () => {\r\n    if (isApplyingConfig) return\r\n    const label = (emptyLabel.value || '').trim() || DEFAULT_CHART_CONFIG.singleParentEmptyCardLabel\r\n    if (label === chartConfig.singleParentEmptyCardLabel) return\r\n    commitConfigUpdate({ singleParentEmptyCardLabel: label, singleParentEmptyCard: true })\r\n  })\r\n\r\n  orientationButtons?.forEach(button => {\r\n    button.addEventListener('click', () => {\r\n      const orientation = button.dataset.orientation\r\n      const nextOrientation = orientation === 'horizontal' ? 'horizontal' : 'vertical'\r\n      if (chartConfig.orientation === nextOrientation) return\r\n      commitConfigUpdate({ orientation: nextOrientation }, { treePosition: 'fit' })\r\n    })\r\n  })\r\n\r\n  function applyCardDimensions() {\r\n    const dims = {}\r\n    add('width', cardWidth)\r\n    add('height', cardHeight)\r\n    add('img_w', imgWidth)\r\n    add('img_h', imgHeight)\r\n    add('img_x', imgX)\r\n    add('img_y', imgY)\r\n\r\n    card.resetCardDim()\r\n    if (Object.keys(dims).length > 0) {\r\n      card.setCardDim(dims)\r\n    }\r\n    chart.updateTree({ initial: false, tree_position: 'inherit' })\r\n\r\n    function add(key, input) {\r\n      if (!input) return\r\n      const value = Number(input.value)\r\n      if (Number.isFinite(value)) dims[key] = value\r\n    }\r\n  }\r\n\r\n  ;[\r\n    cardWidth,\r\n    cardHeight,\r\n    imgWidth,\r\n    imgHeight,\r\n    imgX,\r\n    imgY\r\n  ].forEach(input => input?.addEventListener('change', applyCardDimensions))\r\n\r\n  resetDimensions?.addEventListener('click', () => {\r\n    ;[\r\n      [cardWidth, 240],\r\n      [cardHeight, 150],\r\n      [imgWidth, 80],\r\n      [imgHeight, 80],\r\n      [imgX, 16],\r\n      [imgY, 16]\r\n    ].forEach(([input, value]) => {\r\n      if (input) input.value = value\r\n    })\r\n    applyCardDimensions()\r\n  })\r\n\r\n  assetUploadInput?.addEventListener('change', (event) => {\r\n    const file = event.target.files && event.target.files[0]\r\n    if (file) handleFileUpload(file)\r\n    event.target.value = ''\r\n  })\r\n\r\n  copyUploadUrlBtn?.addEventListener('click', () => {\r\n    const storedUrl = assetUploadResult?.dataset?.url || assetUploadUrlOutput?.textContent?.trim()\r\n    if (storedUrl) applyImageToActiveProfile(storedUrl, { origin: 'manual' })\r\n    copyToClipboard(storedUrl, {\r\n      successMessage: 'URL du t\u00E9l\u00E9versement copi\u00E9e \u2705',\r\n      errorMessage: 'Impossible de copier l\u2019URL du t\u00E9l\u00E9versement.'\r\n    })\r\n  })\r\n\r\n  copyManualUrlBtn?.addEventListener('click', () => {\r\n    const value = manualUrlInput?.value?.trim()\r\n    if (value) applyImageToActiveProfile(value, { origin: 'manual' })\r\n    copyToClipboard(value, {\r\n      successMessage: 'Image appliqu\u00E9e et URL copi\u00E9e \u2705',\r\n      errorMessage: 'Impossible de copier ce lien.'\r\n    })\r\n  })\r\n\r\n  const previousApplyingState = isApplyingConfig\r\n  isApplyingConfig = true\r\n  ensureConfigEditableItems()\r\n  refreshConfigControls()\r\n  applyConfigToEditableControls()\r\n  applyConfigToDisplayControls()\r\n  isApplyingConfig = previousApplyingState\r\n\r\n  applyEditableFields({ suppressSave: true })\r\n\r\n  return {\r\n    refreshMainProfileOptions,\r\n    syncMainProfileSelection,\r\n    handleFormCreation,\r\n    teardown: teardownImageUploader\r\n  }\r\n}\r\n\r\nasync function initialise() {\r\n  destroyTimer()\r\n  editTreeInstance = null\r\n  lastSnapshotString = null\r\n\r\n  try {\r\n    const data = await loadTree()\r\n    setupChart(data)\r\n  } catch (error) {\r\n    console.error(error)\r\n    setStatus(`Erreur: ${error.message}`, 'error')\r\n  }\r\n}\r\n\r\nsaveBtn?.addEventListener('click', () => {\r\n  const snapshot = getSnapshot()\r\n  if (!snapshot) return\r\n  persistChanges(snapshot, { immediate: true })\r\n})\r\n\r\nreloadBtn?.addEventListener('click', () => {\r\n  initialise()\r\n})\r\n\r\nfunction hasUnsavedChanges() {\r\n  const snapshot = getSnapshot()\r\n  if (!snapshot) return false\r\n  const currentString = JSON.stringify(snapshot)\r\n  return currentString !== lastSnapshotString\r\n}\r\n\r\nwindow.addEventListener('beforeunload', (event) => {\r\n  if (!hasUnsavedChanges()) return\r\n  event.preventDefault()\r\n  event.returnValue = ''\r\n})\r\n\r\ninitialise()\r\n"],
  "mappings": "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",
  "names": ["f3", "statusEl", "saveBtn", "reloadBtn", "panel", "chartSelector", "normalizeFieldKey", "value", "sanitizeFieldValues", "values", "seen", "result", "rawValue", "trimmed", "key", "DISPLAY_FIELD_LABELS", "DISPLAY_DEFAULTS", "EDITABLE_DEFAULTS", "DEFAULT_CARD_DISPLAY", "DEFAULT_EDITABLE_FIELDS", "def", "TEXTAREA_FIELD_KEYS", "createBaseFieldLabelStore", "store", "defs", "buildFieldDescriptors", "fields", "labelStore", "label", "type", "DEFAULT_CHART_CONFIG", "row", "normalizeCardDisplay", "rows", "normalized", "cloneCardDisplay", "cardDisplay", "fallbackRows", "_a", "_b", "_c", "_d", "_e", "_f", "_g", "_h", "_i", "_j", "_k", "_l", "_m", "_n", "source", "index", "fallback", "buildChartConfig", "overrides", "base", "sanitizedEditable", "editTreeInstance", "autoSaveTimer", "lastSnapshotString", "isSaving", "queuedSave", "chartConfig", "isApplyingConfig", "currentEditableFields", "activePanelTeardown", "setStatus", "message", "normaliseTreePayload", "payload", "candidateConfig", "normaliseChartConfig", "rawConfig", "_o", "_p", "_q", "_r", "_s", "config", "transition", "cardX", "cardY", "orientation", "showSiblings", "singleParentEnabled", "emptyLabel", "editableFields", "rawCardDisplay", "rawMainId", "rawAncestryDepth", "rawProgenyDepth", "rawMiniTree", "rawDuplicateToggle", "applyChartConfigToChart", "chart", "loadTree", "response", "destroyTimer", "persistChanges", "snapshot", "immediate", "structuredCloneSafe", "error", "next", "getSnapshot", "data", "scheduleAutoSave", "setupChart", "container", "initialEditableFields", "initialFieldDescriptors", "initialCardDisplay", "card", "panelControlAPI", "dataArray", "attachPanelControls", "initialMainId", "resolveInitialMainId", "storeMainId", "mainDatum", "initialSnapshot", "totalPersons", "persons", "chartInstance", "availableIds", "person", "desiredId", "fallbackId", "editableFieldset", "editableList", "addEditableBtn", "displayGroups", "displayGroupMap", "group", "fieldLabelStore", "displayDefaultsByRow", "imageField", "cardStyle", "transitionInput", "cardYSpacing", "cardXSpacing", "ancestryDepthSelect", "progenyDepthSelect", "miniTreeToggle", "duplicateToggle", "orientationButtons", "cardWidth", "cardHeight", "imgWidth", "imgHeight", "imgX", "imgY", "resetDimensions", "mainProfileFieldset", "mainProfileSelect", "mainProfileName", "imageUploader", "assetUploadInput", "assetUploadFeedback", "assetUploadResult", "assetUploadUrlOutput", "assetUploadOpenLink", "copyUploadUrlBtn", "manualUrlInput", "copyManualUrlBtn", "imageUploaderHome", "imageUploaderCurrentForm", "imageUploaderCurrentDatumId", "getActiveImageFieldId", "getActiveDatum", "normaliseUrl", "rawUrl", "applyImageToActiveProfile", "origin", "sizeBytes", "absoluteUrl", "targetFieldId", "escapedFieldId", "formUpdated", "datumUpdated", "targetInput", "activeDatum", "appliedSomewhere", "sizeMessage", "formatBytes", "setUploadFeedback", "populateUploaderFromDatum", "existingValue", "clearUploadResult", "showUploadResult", "restoreImageUploaderToPanel", "parent", "nextSibling", "injectImageUploaderIntoForm", "form", "buttons", "handleFormCreation", "cont", "form_creator", "teardownImageUploader", "MAX_UPLOAD_SIZE", "bytes", "status", "url", "silent", "copyToClipboard", "successMessage", "errorMessage", "temp", "handleFileUpload", "file", "formData", "uploadedUrl", "setOrientationButtonsState", "button", "isActive", "refreshConfigControls", "depthToSelectValue", "commitConfigUpdate", "partialConfig", "treePosition", "refresh", "prevState", "parseNumberInput", "input", "parseDepthSelectValue", "select", "ensureFieldLabel", "createFieldDescriptors", "fieldValues", "safeTrim", "getAllPersons", "buildPersonLabel", "datum", "first", "last", "birth", "updateMainProfileDisplay", "id", "refreshMainProfileOptions", "keepSelection", "previousValue", "placeholder", "fragment", "option", "d", "preferred", "configMain", "targetValue", "syncMainProfileSelection", "scheduleSaveIfChanged", "setMainProfile", "openEditor", "suppressSave", "mainChanged", "configChanged", "event", "escapeSelector", "char", "addRemoveButton", "item", "removeBtn", "updateCardDisplay", "removeDisplayFieldEntries", "fieldKey", "list", "selector", "defaults", "defaultChecked", "checkbox", "getDisplayRowsForField", "field", "ensureConfigEditableItems", "createEditableItem", "applyConfigToEditableControls", "desired", "applyConfigToDisplayControls", "desiredRow", "desiredSet", "createDisplayItem", "removable", "displayLabel", "textEl", "labelEl", "checked", "selectRows", "isNew", "applyEditableFields", "selectRowSet", "rowKey", "shouldCheck", "removableForGroup", "displayItem", "created", "getSelectedValues", "areFieldListsEqual", "a", "b", "areCardDisplaysEqual", "syncDisplayItemsWithEditable", "activeKeys", "row1Group", "row2Group", "row1", "row2", "appliedRows", "applied", "fallbackField", "fallbackKey", "fallbackInput", "fieldDescriptors", "requestFieldDefinition", "suggestedLabel", "labelInput", "handleAddEditableField", "definition", "isDefault", "safeValue", "enabled", "previous", "nextOrientation", "applyCardDimensions", "dims", "add", "storedUrl", "previousApplyingState", "initialise", "hasUnsavedChanges"]
}
