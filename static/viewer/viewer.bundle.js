import*as Ye from"/lib/family-tree.esm.js";var ye=document.getElementById("status"),v=document.getElementById("personDetails"),D=document.getElementById("personSearch"),Y=v==null?void 0:v.querySelector(".detail-list"),b=v==null?void 0:v.querySelector(".summary"),X=v==null?void 0:v.querySelector(".empty"),Oe="#FamilyChart",J=document.getElementById("viewerAncestryDepth"),K=document.getElementById("viewerProgenyDepth"),W=document.getElementById("viewerMiniTree"),Z=document.getElementById("viewerDuplicateToggle"),V=document.querySelector('[data-role="dataset-meta"]'),je=document.querySelector('[data-role="visible-count"]'),xe=document.querySelector('[data-role="branch-count"]'),qe=document.querySelector('[data-role="total-count"]');function Ve(e){return e==null?"":String(e).trim().toLowerCase()}function et(e){if(!Array.isArray(e))return[];let t=new Set,r=[];return e.forEach(n=>{if(typeof n!="string")return;let i=n.trim();if(!i)return;let o=Ve(i);t.has(o)||(t.add(o),r.push(i))}),r}var we=["first name","last name","birthday","death","gender","avatar","bio"],Re={"first name":"Pr\xE9nom","last name":"Nom",nickname:"Surnom","maiden name":"Nom de jeune fille",birthday:"Date de naissance",death:"Date de D\xE9c\xE8s",gender:"Genre",location:"Localisation",birthplace:"Lieu de naissance",deathplace:"Lieu de d\xE9c\xE8s",occupation:"Profession",bio:"Biographie",notes:"Notes",email:"Email",phone:"T\xE9l\xE9phone",avatar:"Avatar"},tt={M:"Masculin",F:"F\xE9minin",O:"Autre",X:"Non binaire"},G="Non renseign\xE9",de=[["first name","last name"],["birthday"]],E=Object.freeze({transitionTime:200,cardXSpacing:240,cardYSpacing:140,orientation:"vertical",showSiblingsOfMain:!0,singleParentEmptyCard:!0,singleParentEmptyCardLabel:"Inconnu",ancestryDepth:4,progenyDepth:4,miniTree:!0,duplicateBranchToggle:!0,cardDisplay:de.map(e=>[...e]),mainId:null}),nt=4,rt=12,d=null,ce=null,s={...E},ee=0,C=!1,h={mainId:null,ancestryDepth:E.ancestryDepth,progenyDepth:E.progenyDepth,includeSiblings:!0,includeSpouses:!0},w=null,q={total:0,returned:0,includeSiblings:!0,includeSpouses:!0},U=null,ae=null,se=null,ue=[],H={source:"initial",label:null},oe=new Map,ge=null,Q={visible:-1,branch:-1,total:-1},be={message:"",type:""};function it(e){let r=(Array.isArray(e)?e:[]).slice(0,2).map(n=>et(Array.isArray(n)?n:[]));for(;r.length<2;)r.push([]);return r}function fe(e){if(Array.isArray(e))return{data:e,config:{},meta:{}};if(e&&typeof e=="object"){let t=e.meta&&typeof e.meta=="object"?e.meta:{};if(Array.isArray(e.data)){let r=e.config||e.settings||{};return{data:e.data,config:r,meta:t}}if(Array.isArray(e.tree)){let r=e.config||e.settings||{};return{data:e.tree,config:r,meta:t}}}return{data:[],config:{},meta:{}}}function at(e={}){var L,A,k,T,F,N,$,B,O,g,_,j,f,S,x,te,ne,z,re,ie,Ie,Pe,Te,Me,Ce,_e,Fe,Ne,$e,Be;if(!e||typeof e!="object")return{};let t={},r=(L=e.transitionTime)!=null?L:e.transition_time;typeof r=="number"&&Number.isFinite(r)&&(t.transitionTime=r);let n=(k=(A=e.cardXSpacing)!=null?A:e.card_x_spacing)!=null?k:e.node_separation;typeof n=="number"&&Number.isFinite(n)&&(t.cardXSpacing=n);let i=(F=(T=e.cardYSpacing)!=null?T:e.card_y_spacing)!=null?F:e.level_separation;typeof i=="number"&&Number.isFinite(i)&&(t.cardYSpacing=i);let o=e.orientation;o==="horizontal"||o==="vertical"?t.orientation=o:typeof e.is_horizontal=="boolean"&&(t.orientation=e.is_horizontal?"horizontal":"vertical");let a=(N=e.showSiblingsOfMain)!=null?N:e.show_siblings_of_main;typeof a=="boolean"&&(t.showSiblingsOfMain=a);let l=($=e.singleParentEmptyCard)!=null?$:e.single_parent_empty_card;typeof l=="boolean"&&(t.singleParentEmptyCard=l);let c=(B=e.singleParentEmptyCardLabel)!=null?B:e.single_parent_empty_card_label;typeof c=="string"&&c.trim().length>0&&(t.singleParentEmptyCardLabel=c.trim());let u=(O=e.cardDisplay)!=null?O:e.card_display;if(Array.isArray(u)||u&&typeof u=="object"){let M=u;u&&!Array.isArray(u)&&typeof u=="object"&&(M=[(te=(x=(S=(f=(j=(_=(g=u[0])!=null?g:u[0])!=null?_:u.row1)!=null?j:u.row_1)!=null?f:u.ligne1)!=null?S:u.line1)!=null?x:u.first)!=null?te:[],(Te=(Pe=(Ie=(ie=(re=(z=(ne=u[1])!=null?ne:u[1])!=null?z:u.row2)!=null?re:u.row_2)!=null?ie:u.ligne2)!=null?Ie:u.line2)!=null?Pe:u.second)!=null?Te:[]]),t.cardDisplay=it(M)}let y=(_e=(Ce=(Me=e.mainId)!=null?Me:e.main_id)!=null?Ce:e.mainPersonId)!=null?_e:e.main_person_id;typeof y=="string"&&y.trim().length>0&&(t.mainId=y.trim());let m=(Fe=e.ancestryDepth)!=null?Fe:e.ancestry_depth;if(m===null)t.ancestryDepth=null;else if(m!==void 0){let M=Number(m);Number.isFinite(M)&&M>=0&&(t.ancestryDepth=Math.floor(M))}let p=(Ne=e.progenyDepth)!=null?Ne:e.progeny_depth;if(p===null)t.progenyDepth=null;else if(p!==void 0){let M=Number(p);Number.isFinite(M)&&M>=0&&(t.progenyDepth=Math.floor(M))}let I=($e=e.miniTree)!=null?$e:e.mini_tree;typeof I=="boolean"&&(t.miniTree=I);let P=(Be=e.duplicateBranchToggle)!=null?Be:e.duplicate_branch_toggle;return typeof P=="boolean"&&(t.duplicateBranchToggle=P),t}function st(e,t){let r=at(t),n={...E,...r},i=r.cardDisplay;return n.cardDisplay=i&&i.length?i.map(o=>[...o]):de.map(o=>[...o]),e.setTransitionTime(n.transitionTime),e.setCardXSpacing(n.cardXSpacing),e.setCardYSpacing(n.cardYSpacing),e.setShowSiblingsOfMain(n.showSiblingsOfMain),n.orientation==="horizontal"?e.setOrientationHorizontal():e.setOrientationVertical(),e.setSingleParentEmptyCard(n.singleParentEmptyCard,{label:n.singleParentEmptyCardLabel}),typeof n.ancestryDepth=="number"&&Number.isFinite(n.ancestryDepth)?e.setAncestryDepth(n.ancestryDepth):e.setAncestryDepth(null),typeof n.progenyDepth=="number"&&Number.isFinite(n.progenyDepth)?e.setProgenyDepth(n.progenyDepth):e.setProgenyDepth(null),e.setDuplicateBranchToggle(n.duplicateBranchToggle!==!1),n}function ke(e){if(e!=="auto"){if(e==="all"||e===null)return"all";if(typeof e=="number"&&Number.isFinite(e)&&e>=0)return String(Math.floor(e))}}function ot(e){let t=new URLSearchParams;t.set("mode","subtree"),e.mainId&&typeof e.mainId=="string"&&t.set("mainId",e.mainId);let r=ke(e.ancestryDepth);r!==void 0&&t.set("ancestryDepth",r);let n=ke(e.progenyDepth);return n!==void 0&&t.set("progenyDepth",n),e.includeSiblings!==void 0&&t.set("includeSiblings",e.includeSiblings?"true":"false"),e.includeSpouses!==void 0&&t.set("includeSpouses",e.includeSpouses?"true":"false"),t.toString()}function pe(e){let t=!!e;V&&V.classList.toggle("is-loading",t),D&&D.classList.toggle("is-loading",t)}function Ue(){U&&(U.abort(),U=null)}function Le(e,t=0,r=t){let n=e&&typeof e=="object"?e:{},i=Number.isFinite(n.total)?Math.max(0,Math.floor(n.total)):Math.max(0,Math.floor(t)),o=Number.isFinite(n.returned)?Math.max(0,Math.floor(n.returned)):Math.max(0,Math.floor(r)),a=n.ancestryDepth===null?null:Number.isFinite(n.ancestryDepth)?Math.max(0,Math.floor(n.ancestryDepth)):void 0,l=n.progenyDepth===null?null:Number.isFinite(n.progenyDepth)?Math.max(0,Math.floor(n.progenyDepth)):void 0;return{total:i,returned:o,includeSiblings:n.includeSiblings!==!1,includeSpouses:n.includeSpouses!==!1,ancestryDepth:a,progenyDepth:l}}function lt(e){return w?["mainId","ancestryDepth","progenyDepth","includeSiblings","includeSpouses"].some(r=>{let n=w[r],i=e[r];return!(n===i||n===null&&i===void 0||n===void 0&&i===null)}):!0}function ct(e){let t=typeof e.label=="string"&&e.label.trim()?e.label.trim():`Profil ${e.id}`,r=[];return typeof e.birthday=="string"&&e.birthday.trim()&&r.push(e.birthday.trim()),typeof e.death=="string"&&e.death.trim()&&r.push(`\u271D ${e.death.trim()}`),typeof e.location=="string"&&e.location.trim()&&r.push(e.location.trim()),{label:t,value:e.id,optionHtml:n=>{let i=n.label_html||n.label,o=r.length?`<small>${r.join(" \xB7 ")}</small>`:"";return`<div>${i}${o?`<div class="f3-autocomplete-meta">${o}</div>`:""}</div>`}}}function ut(e){if(!e||!Array.isArray(e.persons))return[];let t=e.persons.filter(r=>r&&typeof r.id=="string").map(r=>ct(r));return t.sort((r,n)=>r.label.localeCompare(n.label,"fr",{sensitivity:"base"})),t}function De(e){D&&(e?D.dataset.state=String(e):D.dataset.state="")}async function Ge(e=!1){if(!e&&se)return se;if(!e&&ae)return ae;De("loading");let t=new AbortController,r=fetch("/api/tree/summary",{cache:"no-store",signal:t.signal}).then(n=>{if(!n.ok)throw new Error(`HTTP ${n.status}`);return n.json()}).then(n=>(se=n,oe=new Map,Array.isArray(n==null?void 0:n.persons)&&n.persons.forEach(i=>{i&&typeof i.id=="string"&&oe.set(i.id,i)}),ue=ut(n),De("ready"),se)).catch(n=>{if(n.name==="AbortError")return se;throw console.error("Impossible de charger l'index de recherche",n),De("error"),n}).finally(()=>{ae===r&&(ae=null)});return ae=r,r}function Se(e){!e||!e.personSearch||!ue||!ue.length||e.personSearch.setOptionsGetter(()=>ue)}function R(e,t="info"){ye&&(be.message===e&&be.type===t||(be={message:e,type:t},ye.textContent=e,ye.dataset.status=t))}function ze(e,t){return e==="auto"?"auto":e==="all"||e===null?"all":typeof e=="number"&&Number.isFinite(e)&&e>=0?String(Math.floor(e)):typeof t=="number"&&Number.isFinite(t)&&t>=0?String(Math.floor(t)):t==="auto"?"auto":t==="all"||t===null?"all":"auto"}function He(e,t){if(!e)return t;let r=e.value;if(r==="auto")return"auto";if(r==="all"||r==="")return"all";let n=Number(r);return Number.isFinite(n)&&n>=0?Math.floor(n):t}function Ae(e){J&&(J.value=ze(e.ancestryDepth,E.ancestryDepth)),K&&(K.value=ze(e.progenyDepth,E.progenyDepth)),W&&(W.checked=e.miniTree!==!1),Z&&(Z.checked=e.duplicateBranchToggle!==!1)}function ve(){if(ge!==null)return;ge=(typeof requestAnimationFrame=="function"?requestAnimationFrame:t=>setTimeout(t,16))(()=>{var n,i,o,a,l;ge=null;let t=(l=(a=(o=(i=(n=d==null?void 0:d.store)==null?void 0:n.getTree)==null?void 0:i.call(n))==null?void 0:o.data)==null?void 0:a.length)!=null?l:0,r=Number.isFinite(q.returned)?q.returned:t;Q.visible===t&&Q.branch===r&&Q.total===ee||(Q.visible=t,Q.branch=r,Q.total=ee,je&&(je.textContent=String(t)),xe&&(xe.textContent=String(r)),qe&&(qe.textContent=String(ee)),V&&(V.dataset.visible=String(t),V.dataset.total=String(ee),V.dataset.branch=String(r)))})}function Ee({reposition:e=!1,initial:t=!1}={}){d&&(typeof s.ancestryDepth=="number"&&Number.isFinite(s.ancestryDepth)?d.setAncestryDepth(s.ancestryDepth):d.setAncestryDepth(null),typeof s.progenyDepth=="number"&&Number.isFinite(s.progenyDepth)?d.setProgenyDepth(s.progenyDepth):d.setProgenyDepth(null),d.setDuplicateBranchToggle(s.duplicateBranchToggle!==!1),ce&&typeof ce.setMiniTree=="function"&&ce.setMiniTree(s.miniTree!==!1),C=!0,Ae(s),C=!1,d.updateTree({initial:t,tree_position:e?"main_to_middle":"inherit"}),ve())}function dt(){J==null||J.addEventListener("change",()=>{var r,n;if(C)return;let e=(n=(r=s.ancestryDepth)!=null?r:E.ancestryDepth)!=null?n:null,t=He(J,e);t!==s.ancestryDepth&&(s={...s,ancestryDepth:t},le({ancestryDepth:t},{reason:"ancestry-depth-change",source:"controls",reposition:!0,preservePreferences:!0}))}),K==null||K.addEventListener("change",()=>{var r,n;if(C)return;let e=(n=(r=s.progenyDepth)!=null?r:E.progenyDepth)!=null?n:null,t=He(K,e);t!==s.progenyDepth&&(s={...s,progenyDepth:t},le({progenyDepth:t},{reason:"progeny-depth-change",source:"controls",reposition:!0,preservePreferences:!0}))}),W==null||W.addEventListener("change",()=>{if(C)return;let e=W.checked,t=s.miniTree!==!1;e!==t&&(s={...s,miniTree:e},Ee({reposition:!1}))}),Z==null||Z.addEventListener("change",()=>{if(C)return;let e=Z.checked,t=s.duplicateBranchToggle!==!1;e!==t&&(s={...s,duplicateBranchToggle:e},Ee({reposition:!1}))})}dt();function he(e){if(!e||typeof e!="string")return null;if(oe&&oe.has(e)){let t=oe.get(e);if(t&&typeof t.label=="string"&&t.label.trim())return t.label.trim()}return null}function Xe(e){return e==="auto"?"auto (progressif)":e==="all"||e===null?"sans limite":typeof e=="number"&&Number.isFinite(e)?e===0?"profil seul":`${Math.floor(e)}`:"auto (progressif)"}function pt(e){let t=Xe(e.ancestryDepth),r=Xe(e.progenyDepth);return`Ancetres: ${t}, Descendants: ${r}`}async function le(e={},t={}){let r={...h,...e};if(!lt(r)&&!t.force){H={source:t.source||H.source,label:t.selectedLabel||H.label};return}h={...r},H={source:t.source||"system",label:t.selectedLabel||he(r.mainId)||H.label};let n=t.loadingLabel||(t.source==="search"?"Recherche de la branche...":"Chargement de la branche...");R(n,"loading"),pe(!0);let i=new AbortController;Ue(),U=i;let o=r.ancestryDepth==="auto"||r.ancestryDepth===null,a=r.progenyDepth==="auto"||r.progenyDepth===null,l=!t.disableProgressive&&(o||a);try{l?await ft(r,{...t,controller:i}):await Qe(r,{...t,controller:i})}finally{U===i&&(U=null,pe(!1))}}async function ft(e,t={}){var p,I,P,L,A,k,T,F,N,$,B,O;let r=t.controller,n=e.ancestryDepth==="auto"||e.ancestryDepth===null,i=e.progenyDepth==="auto"||e.progenyDepth===null,o=Number.isFinite(t.progressiveStep)&&t.progressiveStep>0?Math.floor(t.progressiveStep):nt,a=Math.max(1,o),l={...e};if(n){let g=Number.isFinite(E.ancestryDepth)?Math.max(0,E.ancestryDepth):a;l.ancestryDepth=Math.max(a,g)}if(i){let g=Number.isFinite(E.progenyDepth)?Math.max(0,E.progenyDepth):a;l.progenyDepth=Math.max(a,g)}let c={...e,ancestryDepth:n?"auto":e.ancestryDepth,progenyDepth:i?"auto":e.progenyDepth},u=0,y=(A=(L=(P=(I=(p=d==null?void 0:d.store)==null?void 0:p.getTree)==null?void 0:I.call(p))==null?void 0:P.data)==null?void 0:L.length)!=null?A:0,m=!1;for(;u<rt;){if(u+=1,(k=r==null?void 0:r.signal)!=null&&k.aborted)return;if(n||i){let S=[];n&&S.push(`anc\xEAtres \u2264 ${l.ancestryDepth}`),i&&S.push(`descendants \u2264 ${l.progenyDepth}`),S.length&&R(`Chargement progressif (${S.join(", ")})...`,"loading")}let g=await Qe(l,{...t,controller:r,progressiveBatch:!0,reposition:u===1?t.reposition:!1});if(!g||g.aborted)return;if(g.error){m=!0;break}let _=g.meta||{},j=(O=(B=($=(N=(F=(T=d==null?void 0:d.store)==null?void 0:T.getTree)==null?void 0:F.call(T))==null?void 0:N.data)==null?void 0:$.length)!=null?B:_.returned)!=null?O:y,f=j-y;if(y=j,f<=0)break;n&&(l.ancestryDepth+=a),i&&(l.progenyDepth+=a)}m||(w={...c},h={...h,...c},s&&(s={...s},n&&(s.ancestryDepth="auto"),i&&(s.progenyDepth="auto"),C=!0,Ae(s),C=!1))}async function Qe(e,t={}){let r=t.controller||new AbortController;t.controller||(Ue(),U=r);let n=ot(e);try{let i=await fetch(`/api/tree?${n}`,{cache:"no-store",signal:r.signal});if(!i.ok)throw new Error(`HTTP ${i.status}`);let o=await i.json();if(r.signal.aborted)return{aborted:!0};let a=fe(o),l=Array.isArray(a.data)?a.data:[],c=Le(a.meta,l.length);return!l.length&&t.reason==="initial"&&!t.allowEmpty?(await Je({...t,preservePreferences:!1,loadingLabel:"Chargement complet de l'arbre...",source:t.source||"system"}),{aborted:!1,meta:c}):(w={...e},ht({data:l,config:a.config,meta:c},{...t,params:e}),{aborted:!1,meta:c})}catch(i){return i.name==="AbortError"?{aborted:!0,error:i}:(console.error("Erreur de chargement de sous-arbre",i),R(`Erreur: ${i&&i.message||"chargement interrompu"}`,"error"),{aborted:!1,error:i})}}function Je(e={}){let t=e.loadingLabel||"Chargement complet de l'arbre...";return R(t,"loading"),pe(!0),fetch("/api/tree",{cache:"no-store"}).then(r=>{if(!r.ok)throw new Error(`HTTP ${r.status}`);return r.json()}).then(r=>{var l,c,u;let n=fe(r),i=Array.isArray(n.data)?n.data:[],o=Le(n.meta,i.length);q=o,ee=o.total;let a=e.mainId||(typeof((l=n.config)==null?void 0:l.mainId)=="string"?n.config.mainId:null)||((u=(c=i[0])==null?void 0:c.id)!=null?u:null);a&&(h={...h,mainId:a}),w=null,Ze({data:i,config:n.config,meta:o},{preservePreferences:e.preservePreferences!==!1,reposition:!0,source:e.source||"system",selectedLabel:e.selectedLabel,mainId:a})}).catch(r=>{console.error("Erreur lors du chargement complet de l'arbre",r),R(`Erreur: ${r&&r.message||"chargement impossible"}`,"error")}).finally(()=>{pe(!1)})}function ht(e,t={}){var y,m,p,I,P,L,A;let{data:r,config:n,meta:i}=fe(e),o=Array.isArray(r)?r:[],a=Le(i,o.length);q=a,ee=a.total;let l=t.params||{},c=l.mainId||(typeof(n==null?void 0:n.mainId)=="string"?n.mainId:null)||((p=(m=(y=o[0])==null?void 0:y.id)!=null?m:h.mainId)!=null?p:null);h={...h,mainId:c,ancestryDepth:(I=l.ancestryDepth)!=null?I:h.ancestryDepth,progenyDepth:(P=l.progenyDepth)!=null?P:h.progenyDepth,includeSiblings:(L=l.includeSiblings)!=null?L:h.includeSiblings,includeSpouses:(A=l.includeSpouses)!=null?A:h.includeSpouses};let u=t.selectedLabel||he(c);Ze({data:o,config:n,meta:a},{preservePreferences:t.preservePreferences!==!1,reposition:t.reposition!==!1,source:t.source||H.source,selectedLabel:u,mainId:c})}function mt(){!v||!X||!Y||!b||(b.textContent="",b.classList.add("hidden"),X.textContent="S\xE9lectionnez une personne pour afficher les informations.",X.classList.remove("hidden"),Y.innerHTML="",ve())}function me(e={}){return[e["first name"],e["last name"]].filter(Boolean).join(" ").trim()}function yt(e){return e==null?!1:typeof e=="string"?e.trim().length>0:Array.isArray(e)?e.length>0:typeof e=="object"?Object.keys(e).length>0:!0}function gt(e={}){let t=e||{},r=we.map(i=>({field:i,value:t[i],mandatory:!0})),n=new Set(we);return Object.entries(t).forEach(([i,o])=>{n.has(i)||yt(o)&&r.push({field:i,value:o,mandatory:!1})}),r}function bt(e){if(!e)return"";let t=e.toLowerCase();return Re[t]?Re[t]:t.replace(/\b\w/g,r=>r.toUpperCase())}function Dt(e){return e.map(t=>typeof t=="string"?t.trim():typeof t=="object"&&t!==null?JSON.stringify(t):String(t)).filter(Boolean).join(", ")}function St(e,t){if(t===void 0)return{text:G,empty:!0};if(e==="avatar"){let i=(t||"").toString().trim();return i?{type:"avatar",url:i}:{text:G,empty:!0}}if(e==="gender"&&typeof t=="string")return{text:tt[t.toUpperCase()]||t};if(t===null)return{text:G,empty:!0};if(Array.isArray(t))return t.length?{text:Dt(t)}:{text:G,empty:!0};if(typeof t=="object"){let i=JSON.stringify(t,null,2);return i?{text:i,pre:!0}:{text:G,empty:!0}}let r=String(t).trim();if(!r)return{text:G,empty:!0};let n=r.includes(`
`)||r.length>80;return{text:r,pre:n}}function Et(e,t){if(!Y)return;let r=document.createElement("article");r.className="detail-item";let n=document.createElement("span");if(n.className="detail-label",n.textContent=bt(e),r.append(n),t.type==="avatar"){let o=document.createElement("div");o.className="avatar-preview";let a=document.createElement("img");a.src=t.url,a.alt=`Avatar de ${(b==null?void 0:b.textContent)||"la personne s\xE9lectionn\xE9e"}`,a.loading="lazy";let l=document.createElement("a");l.href=t.url,l.target="_blank",l.rel="noopener",l.textContent="Ouvrir l\u2019image",o.append(a,l),r.append(o),Y.append(r);return}let i=document.createElement("div");i.className="detail-value",t.pre&&i.classList.add("preformatted"),t.empty&&i.classList.add("empty"),i.textContent=t.text,r.append(i),Y.append(r)}function Ke(e){if(!v||!Y||!X||!b)return;let t=(e==null?void 0:e.data)||{};Y.innerHTML="";let r=me(t),n=[];t.birthday&&n.push(`N\xE9(e) : ${t.birthday}`),t.death&&n.push(`D\xE9c\xE8s : ${t.death}`),r?(b.textContent=n.length?`${r} \xB7 ${n.join(" \xB7 ")}`:r,b.classList.remove("hidden")):n.length?(b.textContent=n.join(" \xB7 "),b.classList.remove("hidden")):(b.textContent="",b.classList.add("hidden"));let i=gt(t),o=0;i.forEach(a=>{let l=St(a.field,a.value);l.empty||(Et(a.field,l),o+=1)}),o===0?(X.textContent="Aucune information suppl\xE9mentaire disponible.",X.classList.remove("hidden")):X.classList.add("hidden")}function We(e,t="card"){if(!e)return;let r=me(e.data||{})||`Profil ${e.id}`;if(Ke(e),d&&(d.updateMainId(e.id),d.updateTree({initial:!1,tree_position:"main_to_middle"})),R(`${t==="search"?"Resultat":"Selection"} : ${r}`,"info"),t==="search"){let i=D==null?void 0:D.querySelector("input");i&&(i.value="",i.blur())}le({mainId:e.id},{source:t,reposition:!0,preservePreferences:!0,selectedLabel:r,loadingLabel:`${t==="search"?"Recherche":"Selection"} : ${r}...`})}function Lt(e){if(!D)return;D.innerHTML="",e.setPersonDropdown(n=>{let i=n.data||{},o=me(i)||"Profil sans nom",a=[];return i.birthday&&a.push(i.birthday),i.death&&a.push(`\u271D ${i.death}`),a.length?`${o} (${a.join(" \xB7 ")})`:o},{cont:D,placeholder:"Rechercher une personne...",onSelect:n=>{var a,l;let i=(l=(a=e.store)==null?void 0:a.getDatum)==null?void 0:l.call(a,n);if(i){We(i,"search");return}let o=he(n)||`Profil ${n}`;le({mainId:n},{source:"search",reposition:!0,preservePreferences:!0,selectedLabel:o,loadingLabel:`Recherche : ${o}...`})}});let t=D.querySelector(".f3-autocomplete-items");if(t){let n=()=>{let o=t.childElementCount>0;t.classList.toggle("is-empty",!o),o?t.tabIndex=0:t.removeAttribute("tabindex")};n(),new MutationObserver(n).observe(t,{childList:!0})}let r=D.querySelector("input");r&&(r.id="personSearchInput"),Se(e),Ge().then(()=>{Se(e)}).catch(()=>{})}function Ze(e,t={}){var T,F,N,$,B,O,g,_,j;let r=document.querySelector(Oe);if(!r)throw new Error("Conteneur du graphique introuvable");d&&typeof d.unSetPersonSearch=="function"&&d.unSetPersonSearch(),r.innerHTML="",mt();let n=e&&e.data!==void 0?e:fe(e),i=Array.isArray(n.data)?n.data:[],o=n.config||{},a=Ye.createChart(Oe,i),l=st(a,o),c={...l,mainId:t.mainId||l.mainId||s.mainId||null,ancestryDepth:h.ancestryDepth,progenyDepth:h.progenyDepth,duplicateBranchToggle:t.preservePreferences&&s?s.duplicateBranchToggle!==!1:l.duplicateBranchToggle,miniTree:t.preservePreferences&&s?s.miniTree!==!1:l.miniTree!==!1,cardDisplay:l.cardDisplay&&l.cardDisplay.length?l.cardDisplay.map(f=>[...f]):de.map(f=>[...f])};t.preservePreferences&&s&&(c.cardDisplay=s.cardDisplay&&s.cardDisplay.length?s.cardDisplay.map(f=>[...f]):c.cardDisplay,c.transitionTime=(T=s.transitionTime)!=null?T:c.transitionTime,c.cardXSpacing=(F=s.cardXSpacing)!=null?F:c.cardXSpacing,c.cardYSpacing=(N=s.cardYSpacing)!=null?N:c.cardYSpacing,c.singleParentEmptyCard=($=s.singleParentEmptyCard)!=null?$:c.singleParentEmptyCard,c.singleParentEmptyCardLabel=(B=s.singleParentEmptyCardLabel)!=null?B:c.singleParentEmptyCardLabel,c.orientation=(O=s.orientation)!=null?O:c.orientation),s={...c},s.mainId=c.mainId,d=a;let u=s.cardDisplay&&s.cardDisplay.length?s.cardDisplay.map(f=>[...f]):de.map(f=>[...f]),y=a.setCardHtml().setCardDisplay(u).setMiniTree(s.miniTree!==!1);ce=y,a.setDuplicateBranchToggle(s.duplicateBranchToggle!==!1),C=!0,Ae(s),C=!1,y.setOnCardClick((f,S)=>{var ne,z,re;y.onCardClickDefault(f,S);let x=(ne=S==null?void 0:S.data)==null?void 0:ne.id;if(!x)return;let te=(re=(z=a.store)==null?void 0:z.getDatum)==null?void 0:re.call(z,x);if(te)We(te,"card");else{let ie=he(x)||`Profil ${x}`;le({mainId:x},{source:"card",reposition:!0,preservePreferences:!0,selectedLabel:ie,loadingLabel:`Selection : ${ie}...`})}}),s.mainId&&a.updateMainId(s.mainId),Lt(a),Ee({reposition:t.reposition!==!1,initial:t.preservePreferences===!1});let m=(g=a.getMainDatum)==null?void 0:g.call(a),p=((j=(_=a.store)==null?void 0:_.getMainId)==null?void 0:j.call(_))||s.mainId;p&&p!==s.mainId&&(s.mainId=p),p&&(h.mainId=p,w&&(w={...w,mainId:p})),m&&Ke(m),ve();let I=Number.isFinite(q.returned)?q.returned:i.length,P=Number.isFinite(q.total)?q.total:i.length,L=m?me(m.data||{})||`Profil ${m.id}`:t.selectedLabel||"Branche courante",A=t.source==="search"?"Resultat":t.source==="card"?"Selection":"Branche",k=pt(s);R(`${A} : ${L} - ${I} profil(s) dans la branche / ${P} au total - ${k}`,"success"),H={source:t.source||A.toLowerCase(),label:L},Ge().then(()=>{Se(a)}).catch(()=>{})}Je({preservePreferences:!1,source:"system"}).catch(()=>{R("Impossible de charger les donn\xE9es","error")});
//# sourceMappingURL=viewer.bundle.js.map
