{
  "version": 3,
  "sources": ["viewer.js"],
  "sourcesContent": ["import * as f3 from '/lib/family-tree.esm.js'\r\n\r\nconst statusEl = document.getElementById('status')\r\nconst detailsPanel = document.getElementById('personDetails')\r\nconst searchContainer = document.getElementById('personSearch')\r\nconst detailsList = detailsPanel?.querySelector('.detail-list')\r\nconst detailsSummary = detailsPanel?.querySelector('.summary')\r\nconst emptyState = detailsPanel?.querySelector('.empty')\r\nconst chartSelector = '#FamilyChart'\r\nconst ancestryDepthControl = document.getElementById('viewerAncestryDepth')\r\nconst progenyDepthControl = document.getElementById('viewerProgenyDepth')\r\nconst miniTreeToggle = document.getElementById('viewerMiniTree')\r\nconst duplicateToggle = document.getElementById('viewerDuplicateToggle')\r\nconst datasetMeta = document.querySelector('[data-role=\"dataset-meta\"]')\r\nconst visibleCountEl = document.querySelector('[data-role=\"visible-count\"]')\r\nconst branchCountEl = document.querySelector('[data-role=\"branch-count\"]')\r\nconst totalCountEl = document.querySelector('[data-role=\"total-count\"]')\r\n\r\nfunction normalizeFieldKey(value) {\r\n  if (value === undefined || value === null) return ''\r\n  return String(value).trim().toLowerCase()\r\n}\r\n\r\nfunction sanitizeFieldValues(values) {\r\n  if (!Array.isArray(values)) return []\r\n  const seen = new Set()\r\n  const result = []\r\n  values.forEach(rawValue => {\r\n    if (typeof rawValue !== 'string') return\r\n    const trimmed = rawValue.trim()\r\n    if (!trimmed) return\r\n    const key = normalizeFieldKey(trimmed)\r\n    if (seen.has(key)) return\r\n    seen.add(key)\r\n    result.push(trimmed)\r\n  })\r\n  return result\r\n}\r\n\r\nconst DETAIL_FIELD_ORDER = [\r\n  'first name',\r\n  'last name',\r\n  'birthday',\r\n  'death',\r\n  'gender',\r\n  'avatar',\r\n  'bio'\r\n]\r\n\r\nconst FIELD_LABELS = {\r\n  'first name': 'Pr\u00E9nom',\r\n  'last name': 'Nom',\r\n  'nickname': 'Surnom',\r\n  'maiden name': 'Nom de jeune fille',\r\n  'birthday': 'Date de naissance',\r\n  'death': 'Date de D\u00E9c\u00E8s',\r\n  'gender': 'Genre',\r\n  'location': 'Localisation',\r\n  'birthplace': 'Lieu de naissance',\r\n  'deathplace': 'Lieu de d\u00E9c\u00E8s',\r\n  'occupation': 'Profession',\r\n  'bio': 'Biographie',\r\n  'notes': 'Notes',\r\n  'email': 'Email',\r\n  'phone': 'T\u00E9l\u00E9phone',\r\n  'avatar': 'Avatar'\r\n}\r\n\r\nconst GENDER_LABELS = {\r\n  'M': 'Masculin',\r\n  'F': 'F\u00E9minin',\r\n  'O': 'Autre',\r\n  'X': 'Non binaire'\r\n}\r\n\r\nconst DEFAULT_EMPTY_LABEL = 'Non renseign\u00E9'\r\n\r\nconst DEFAULT_CARD_DISPLAY = [\r\n  ['first name', 'last name'],\r\n  ['birthday']\r\n]\r\n\r\nconst DEFAULT_CHART_CONFIG = Object.freeze({\r\n  transitionTime: 200,\r\n  cardXSpacing: 240,\r\n  cardYSpacing: 140,\r\n  orientation: 'vertical',\r\n  showSiblingsOfMain: true,\r\n  singleParentEmptyCard: true,\r\n  singleParentEmptyCardLabel: 'Inconnu',\r\n  ancestryDepth: 4,\r\n  progenyDepth: 4,\r\n  miniTree: true,\r\n  duplicateBranchToggle: true,\r\n  cardDisplay: DEFAULT_CARD_DISPLAY.map(row => [...row]),\r\n  mainId: null\r\n})\r\n\r\nconst PROGRESSIVE_DEPTH_STEP = 4\r\nconst PROGRESSIVE_MAX_STEPS = 12\r\n\r\nlet chartInstance = null\r\nlet cardInstance = null\r\nlet viewerConfig = { ...DEFAULT_CHART_CONFIG }\r\nlet totalPersons = 0\r\nlet isApplyingViewerConfig = false\r\nlet serverQueryState = {\r\n  mainId: null,\r\n  ancestryDepth: DEFAULT_CHART_CONFIG.ancestryDepth,\r\n  progenyDepth: DEFAULT_CHART_CONFIG.progenyDepth,\r\n  includeSiblings: true,\r\n  includeSpouses: true\r\n}\r\nlet lastSuccessfulQuery = null\r\nlet latestMeta = {\r\n  total: 0,\r\n  returned: 0,\r\n  includeSiblings: true,\r\n  includeSpouses: true\r\n}\r\nlet activeFetchController = null\r\nlet searchSummaryPromise = null\r\nlet peopleSummary = null\r\nlet searchOptions = []\r\nlet lastSelectionContext = { source: 'initial', label: null }\r\nlet peopleSummaryIndex = new Map()\r\nlet pendingMetaFrame = null\r\nconst lastMetaSnapshot = { visible: -1, branch: -1, total: -1 }\r\nlet lastStatusSnapshot = { message: '', type: '' }\r\n\r\nfunction normalizeCardDisplay(rows) {\r\n  const safeRows = Array.isArray(rows) ? rows : []\r\n  const normalized = safeRows.slice(0, 2).map(row => sanitizeFieldValues(Array.isArray(row) ? row : []))\r\n  while (normalized.length < 2) normalized.push([])\r\n  return normalized\r\n}\r\n\r\nfunction normaliseTreePayload(payload) {\r\n  if (Array.isArray(payload)) {\r\n    return { data: payload, config: {}, meta: {} }\r\n  }\r\n\r\n  if (payload && typeof payload === 'object') {\r\n    const meta = payload.meta && typeof payload.meta === 'object' ? payload.meta : {}\r\n    if (Array.isArray(payload.data)) {\r\n      const candidateConfig = payload.config || payload.settings || {}\r\n      return { data: payload.data, config: candidateConfig, meta }\r\n    }\r\n\r\n    if (Array.isArray(payload.tree)) {\r\n      const candidateConfig = payload.config || payload.settings || {}\r\n      return { data: payload.tree, config: candidateConfig, meta }\r\n    }\r\n  }\r\n\r\n  return { data: [], config: {}, meta: {} }\r\n}\r\n\r\nfunction normaliseChartConfig(rawConfig = {}) {\r\n  if (!rawConfig || typeof rawConfig !== 'object') return {}\r\n\r\n  const config = {}\r\n  const transition = rawConfig.transitionTime ?? rawConfig.transition_time\r\n  if (typeof transition === 'number' && Number.isFinite(transition)) {\r\n    config.transitionTime = transition\r\n  }\r\n\r\n  const cardX = rawConfig.cardXSpacing ?? rawConfig.card_x_spacing ?? rawConfig.node_separation\r\n  if (typeof cardX === 'number' && Number.isFinite(cardX)) {\r\n    config.cardXSpacing = cardX\r\n  }\r\n\r\n  const cardY = rawConfig.cardYSpacing ?? rawConfig.card_y_spacing ?? rawConfig.level_separation\r\n  if (typeof cardY === 'number' && Number.isFinite(cardY)) {\r\n    config.cardYSpacing = cardY\r\n  }\r\n\r\n  const orientation = rawConfig.orientation\r\n  if (orientation === 'horizontal' || orientation === 'vertical') {\r\n    config.orientation = orientation\r\n  } else if (typeof rawConfig.is_horizontal === 'boolean') {\r\n    config.orientation = rawConfig.is_horizontal ? 'horizontal' : 'vertical'\r\n  }\r\n\r\n  const showSiblings = rawConfig.showSiblingsOfMain ?? rawConfig.show_siblings_of_main\r\n  if (typeof showSiblings === 'boolean') {\r\n    config.showSiblingsOfMain = showSiblings\r\n  }\r\n\r\n  const singleParentEnabled = rawConfig.singleParentEmptyCard ?? rawConfig.single_parent_empty_card\r\n  if (typeof singleParentEnabled === 'boolean') {\r\n    config.singleParentEmptyCard = singleParentEnabled\r\n  }\r\n\r\n  const emptyLabel = rawConfig.singleParentEmptyCardLabel ?? rawConfig.single_parent_empty_card_label\r\n  if (typeof emptyLabel === 'string' && emptyLabel.trim().length > 0) {\r\n    config.singleParentEmptyCardLabel = emptyLabel.trim()\r\n  }\r\n\r\n  const rawCardDisplay = rawConfig.cardDisplay ?? rawConfig.card_display\r\n  if (Array.isArray(rawCardDisplay) || (rawCardDisplay && typeof rawCardDisplay === 'object')) {\r\n    let source = rawCardDisplay\r\n    if (rawCardDisplay && !Array.isArray(rawCardDisplay) && typeof rawCardDisplay === 'object') {\r\n      source = [\r\n        rawCardDisplay[0] ?? rawCardDisplay['0'] ?? rawCardDisplay.row1 ?? rawCardDisplay.row_1 ?? rawCardDisplay.ligne1 ?? rawCardDisplay.line1 ?? rawCardDisplay.first ?? [],\r\n        rawCardDisplay[1] ?? rawCardDisplay['1'] ?? rawCardDisplay.row2 ?? rawCardDisplay.row_2 ?? rawCardDisplay.ligne2 ?? rawCardDisplay.line2 ?? rawCardDisplay.second ?? []\r\n      ]\r\n    }\r\n    config.cardDisplay = normalizeCardDisplay(source)\r\n  }\r\n\r\n  const rawMainId = rawConfig.mainId ?? rawConfig.main_id ?? rawConfig.mainPersonId ?? rawConfig.main_person_id\r\n  if (typeof rawMainId === 'string' && rawMainId.trim().length > 0) {\r\n    config.mainId = rawMainId.trim()\r\n  }\r\n\r\n  const rawAncestryDepth = rawConfig.ancestryDepth ?? rawConfig.ancestry_depth\r\n  if (rawAncestryDepth === null) {\r\n    config.ancestryDepth = null\r\n  } else if (rawAncestryDepth !== undefined) {\r\n    const value = Number(rawAncestryDepth)\r\n    if (Number.isFinite(value) && value >= 0) {\r\n      config.ancestryDepth = Math.floor(value)\r\n    }\r\n  }\r\n\r\n  const rawProgenyDepth = rawConfig.progenyDepth ?? rawConfig.progeny_depth\r\n  if (rawProgenyDepth === null) {\r\n    config.progenyDepth = null\r\n  } else if (rawProgenyDepth !== undefined) {\r\n    const value = Number(rawProgenyDepth)\r\n    if (Number.isFinite(value) && value >= 0) {\r\n      config.progenyDepth = Math.floor(value)\r\n    }\r\n  }\r\n\r\n  const rawMiniTree = rawConfig.miniTree ?? rawConfig.mini_tree\r\n  if (typeof rawMiniTree === 'boolean') {\r\n    config.miniTree = rawMiniTree\r\n  }\r\n\r\n  const rawDuplicateToggle = rawConfig.duplicateBranchToggle ?? rawConfig.duplicate_branch_toggle\r\n  if (typeof rawDuplicateToggle === 'boolean') {\r\n    config.duplicateBranchToggle = rawDuplicateToggle\r\n  }\r\n\r\n  return config\r\n}\r\n\r\nfunction applyConfigToChart(chart, rawConfig) {\r\n  const overrides = normaliseChartConfig(rawConfig)\r\n  const config = { ...DEFAULT_CHART_CONFIG, ...overrides }\r\n\r\n  const cardDisplayOverride = overrides.cardDisplay\r\n  config.cardDisplay = (cardDisplayOverride && cardDisplayOverride.length)\r\n    ? cardDisplayOverride.map(row => [...row])\r\n    : DEFAULT_CARD_DISPLAY.map(row => [...row])\r\n\r\n  chart.setTransitionTime(config.transitionTime)\r\n  chart.setCardXSpacing(config.cardXSpacing)\r\n  chart.setCardYSpacing(config.cardYSpacing)\r\n  chart.setShowSiblingsOfMain(config.showSiblingsOfMain)\r\n\r\n  if (config.orientation === 'horizontal') {\r\n    chart.setOrientationHorizontal()\r\n  } else {\r\n    chart.setOrientationVertical()\r\n  }\r\n\r\n  chart.setSingleParentEmptyCard(config.singleParentEmptyCard, {\r\n    label: config.singleParentEmptyCardLabel\r\n  })\r\n\r\n  if (typeof config.ancestryDepth === 'number' && Number.isFinite(config.ancestryDepth)) {\r\n    chart.setAncestryDepth(config.ancestryDepth)\r\n  } else {\r\n    chart.setAncestryDepth(null)\r\n  }\r\n\r\n  if (typeof config.progenyDepth === 'number' && Number.isFinite(config.progenyDepth)) {\r\n    chart.setProgenyDepth(config.progenyDepth)\r\n  } else {\r\n    chart.setProgenyDepth(null)\r\n  }\r\n\r\n  chart.setDuplicateBranchToggle(config.duplicateBranchToggle !== false)\r\n\r\n  return config\r\n}\r\n\r\nfunction serialiseDepthParam(value) {\r\n  if (value === 'auto') return undefined\r\n  if (value === 'all' || value === null) return 'all'\r\n  if (typeof value === 'number' && Number.isFinite(value) && value >= 0) {\r\n    return String(Math.floor(value))\r\n  }\r\n  return undefined\r\n}\r\n\r\nfunction buildSubtreeQuery(params) {\r\n  const query = new URLSearchParams()\r\n  query.set('mode', 'subtree')\r\n\r\n  if (params.mainId && typeof params.mainId === 'string') {\r\n    query.set('mainId', params.mainId)\r\n  }\r\n\r\n  const ancestryDepth = serialiseDepthParam(params.ancestryDepth)\r\n  if (ancestryDepth !== undefined) {\r\n    query.set('ancestryDepth', ancestryDepth)\r\n  }\r\n\r\n  const progenyDepth = serialiseDepthParam(params.progenyDepth)\r\n  if (progenyDepth !== undefined) {\r\n    query.set('progenyDepth', progenyDepth)\r\n  }\r\n\r\n  if (params.includeSiblings !== undefined) {\r\n    query.set('includeSiblings', params.includeSiblings ? 'true' : 'false')\r\n  }\r\n\r\n  if (params.includeSpouses !== undefined) {\r\n    query.set('includeSpouses', params.includeSpouses ? 'true' : 'false')\r\n  }\r\n\r\n  return query.toString()\r\n}\r\n\r\nfunction setInterfaceLoading(isLoading) {\r\n  const loading = Boolean(isLoading)\r\n  if (datasetMeta) datasetMeta.classList.toggle('is-loading', loading)\r\n  if (searchContainer) searchContainer.classList.toggle('is-loading', loading)\r\n}\r\n\r\nfunction abortActiveFetch() {\r\n  if (activeFetchController) {\r\n    activeFetchController.abort()\r\n    activeFetchController = null\r\n  }\r\n}\r\n\r\nfunction normaliseMeta(meta, fallbackTotal = 0, fallbackReturned = fallbackTotal) {\r\n  const payloadMeta = meta && typeof meta === 'object' ? meta : {}\r\n  const total = Number.isFinite(payloadMeta.total) ? Math.max(0, Math.floor(payloadMeta.total)) : Math.max(0, Math.floor(fallbackTotal))\r\n  const returned = Number.isFinite(payloadMeta.returned) ? Math.max(0, Math.floor(payloadMeta.returned)) : Math.max(0, Math.floor(fallbackReturned))\r\n  const ancestryDepth = payloadMeta.ancestryDepth === null\r\n    ? null\r\n    : Number.isFinite(payloadMeta.ancestryDepth)\r\n      ? Math.max(0, Math.floor(payloadMeta.ancestryDepth))\r\n      : undefined\r\n  const progenyDepth = payloadMeta.progenyDepth === null\r\n    ? null\r\n    : Number.isFinite(payloadMeta.progenyDepth)\r\n      ? Math.max(0, Math.floor(payloadMeta.progenyDepth))\r\n      : undefined\r\n\r\n  return {\r\n    total,\r\n    returned,\r\n    includeSiblings: payloadMeta.includeSiblings !== false,\r\n    includeSpouses: payloadMeta.includeSpouses !== false,\r\n    ancestryDepth,\r\n    progenyDepth\r\n  }\r\n}\r\n\r\nfunction hasQueryChanged(nextParams) {\r\n  if (!lastSuccessfulQuery) return true\r\n  const keys = ['mainId', 'ancestryDepth', 'progenyDepth', 'includeSiblings', 'includeSpouses']\r\n  return keys.some(key => {\r\n    const previous = lastSuccessfulQuery[key]\r\n    const next = nextParams[key]\r\n    if (previous === next) return false\r\n    if (previous === null && next === undefined) return false\r\n    if (previous === undefined && next === null) return false\r\n    return true\r\n  })\r\n}\r\n\r\nfunction buildSearchOption(person) {\r\n  const label = typeof person.label === 'string' && person.label.trim() ? person.label.trim() : `Profil ${person.id}`\r\n  const metaParts = []\r\n  if (typeof person.birthday === 'string' && person.birthday.trim()) metaParts.push(person.birthday.trim())\r\n  if (typeof person.death === 'string' && person.death.trim()) metaParts.push(`\u271D ${person.death.trim()}`)\r\n  if (typeof person.location === 'string' && person.location.trim()) metaParts.push(person.location.trim())\r\n\r\n  return {\r\n    label,\r\n    value: person.id,\r\n    optionHtml: (option) => {\r\n      const title = option.label_html || option.label\r\n      const meta = metaParts.length ? `<small>${metaParts.join(' \u00B7 ')}</small>` : ''\r\n      return `<div>${title}${meta ? `<div class=\"f3-autocomplete-meta\">${meta}</div>` : ''}</div>`\r\n    }\r\n  }\r\n}\r\n\r\nfunction buildSearchOptionsFromSummary(summary) {\r\n  if (!summary || !Array.isArray(summary.persons)) return []\r\n  const options = summary.persons\r\n    .filter(person => person && typeof person.id === 'string')\r\n    .map(person => buildSearchOption(person))\r\n  options.sort((a, b) => a.label.localeCompare(b.label, 'fr', { sensitivity: 'base' }))\r\n  return options\r\n}\r\n\r\nfunction setSearchLoadingState(state) {\r\n  if (!searchContainer) return\r\n  if (!state) {\r\n    searchContainer.dataset.state = ''\r\n  } else {\r\n    searchContainer.dataset.state = String(state)\r\n  }\r\n}\r\n\r\nasync function ensurePeopleSummary(force = false) {\r\n  if (!force && peopleSummary) return peopleSummary\r\n  if (!force && searchSummaryPromise) return searchSummaryPromise\r\n\r\n  setSearchLoadingState('loading')\r\n  const controller = new AbortController()\r\n  const promise = fetch('/api/tree/summary', { cache: 'no-store', signal: controller.signal })\r\n    .then(response => {\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP ${response.status}`)\r\n      }\r\n      return response.json()\r\n    })\r\n    .then(summary => {\r\n      peopleSummary = summary\r\n      peopleSummaryIndex = new Map()\r\n      if (Array.isArray(summary?.persons)) {\r\n        summary.persons.forEach(person => {\r\n          if (person && typeof person.id === 'string') {\r\n            peopleSummaryIndex.set(person.id, person)\r\n          }\r\n        })\r\n      }\r\n      searchOptions = buildSearchOptionsFromSummary(summary)\r\n      setSearchLoadingState('ready')\r\n      return peopleSummary\r\n    })\r\n    .catch(error => {\r\n      if (error.name === 'AbortError') return peopleSummary\r\n      console.error('Impossible de charger l\\'index de recherche', error)\r\n      setSearchLoadingState('error')\r\n      throw error\r\n    })\r\n    .finally(() => {\r\n      if (searchSummaryPromise === promise) {\r\n        searchSummaryPromise = null\r\n      }\r\n    })\r\n\r\n  searchSummaryPromise = promise\r\n  return promise\r\n}\r\n\r\nfunction updateSearchOptionsForChart(chart) {\r\n  if (!chart || !chart.personSearch) return\r\n  if (!searchOptions || !searchOptions.length) return\r\n  chart.personSearch.setOptionsGetter(() => searchOptions)\r\n}\r\n\r\nfunction setStatus(message, type = 'info') {\r\n  if (!statusEl) return\r\n  if (lastStatusSnapshot.message === message && lastStatusSnapshot.type === type) {\r\n    return\r\n  }\r\n  lastStatusSnapshot = { message, type }\r\n  statusEl.textContent = message\r\n  statusEl.dataset.status = type\r\n}\r\n\r\nfunction depthToSelectValue(value, fallback) {\r\n  if (value === 'auto') return 'auto'\r\n  if (value === 'all') return 'all'\r\n  if (value === null) return 'all'\r\n  if (typeof value === 'number' && Number.isFinite(value) && value >= 0) {\r\n    return String(Math.floor(value))\r\n  }\r\n  if (typeof fallback === 'number' && Number.isFinite(fallback) && fallback >= 0) {\r\n    return String(Math.floor(fallback))\r\n  }\r\n  if (fallback === 'auto') return 'auto'\r\n  if (fallback === 'all' || fallback === null) return 'all'\r\n  return 'auto'\r\n}\r\n\r\nfunction parseDepthSelectValue(select, fallback) {\r\n  if (!select) return fallback\r\n  const raw = select.value\r\n  if (raw === 'auto') return 'auto'\r\n  if (raw === 'all' || raw === '') return 'all'\r\n  const value = Number(raw)\r\n  if (Number.isFinite(value) && value >= 0) {\r\n    return Math.floor(value)\r\n  }\r\n  return fallback\r\n}\r\n\r\nfunction updatePerformanceControlsUI(config) {\r\n  if (ancestryDepthControl) ancestryDepthControl.value = depthToSelectValue(config.ancestryDepth, DEFAULT_CHART_CONFIG.ancestryDepth)\r\n  if (progenyDepthControl) progenyDepthControl.value = depthToSelectValue(config.progenyDepth, DEFAULT_CHART_CONFIG.progenyDepth)\r\n  if (miniTreeToggle) miniTreeToggle.checked = config.miniTree !== false\r\n  if (duplicateToggle) duplicateToggle.checked = config.duplicateBranchToggle !== false\r\n}\r\n\r\nfunction updateDatasetMeta() {\r\n  if (pendingMetaFrame !== null) return\r\n  const schedule = typeof requestAnimationFrame === 'function' ? requestAnimationFrame : (cb) => setTimeout(cb, 16)\r\n  pendingMetaFrame = schedule(() => {\r\n    pendingMetaFrame = null\r\n    const visible = chartInstance?.store?.getTree?.()?.data?.length ?? 0\r\n    const branchCount = Number.isFinite(latestMeta.returned) ? latestMeta.returned : visible\r\n\r\n    if (lastMetaSnapshot.visible === visible && lastMetaSnapshot.branch === branchCount && lastMetaSnapshot.total === totalPersons) {\r\n      return\r\n    }\r\n\r\n    lastMetaSnapshot.visible = visible\r\n    lastMetaSnapshot.branch = branchCount\r\n    lastMetaSnapshot.total = totalPersons\r\n\r\n    if (visibleCountEl) visibleCountEl.textContent = String(visible)\r\n    if (branchCountEl) branchCountEl.textContent = String(branchCount)\r\n    if (totalCountEl) totalCountEl.textContent = String(totalPersons)\r\n    if (datasetMeta) {\r\n      datasetMeta.dataset.visible = String(visible)\r\n      datasetMeta.dataset.total = String(totalPersons)\r\n      datasetMeta.dataset.branch = String(branchCount)\r\n    }\r\n  })\r\n}\r\n\r\nfunction applyViewerConfig({ reposition = false, initial = false } = {}) {\r\n  if (!chartInstance) return\r\n  if (typeof viewerConfig.ancestryDepth === 'number' && Number.isFinite(viewerConfig.ancestryDepth)) {\r\n    chartInstance.setAncestryDepth(viewerConfig.ancestryDepth)\r\n  } else {\r\n    chartInstance.setAncestryDepth(null)\r\n  }\r\n\r\n  if (typeof viewerConfig.progenyDepth === 'number' && Number.isFinite(viewerConfig.progenyDepth)) {\r\n    chartInstance.setProgenyDepth(viewerConfig.progenyDepth)\r\n  } else {\r\n    chartInstance.setProgenyDepth(null)\r\n  }\r\n\r\n  chartInstance.setDuplicateBranchToggle(viewerConfig.duplicateBranchToggle !== false)\r\n\r\n  if (cardInstance && typeof cardInstance.setMiniTree === 'function') {\r\n    cardInstance.setMiniTree(viewerConfig.miniTree !== false)\r\n  }\r\n\r\n  isApplyingViewerConfig = true\r\n  updatePerformanceControlsUI(viewerConfig)\r\n  isApplyingViewerConfig = false\r\n\r\n  chartInstance.updateTree({ initial, tree_position: reposition ? 'main_to_middle' : 'inherit' })\r\n  updateDatasetMeta()\r\n}\r\n\r\nfunction attachPerformanceHandlers() {\r\n  ancestryDepthControl?.addEventListener('change', () => {\r\n    if (isApplyingViewerConfig) return\r\n    const fallback = viewerConfig.ancestryDepth ?? DEFAULT_CHART_CONFIG.ancestryDepth ?? null\r\n    const value = parseDepthSelectValue(ancestryDepthControl, fallback)\r\n    if (value === viewerConfig.ancestryDepth) return\r\n    viewerConfig = { ...viewerConfig, ancestryDepth: value }\r\n    requestSubtree({ ancestryDepth: value }, {\r\n      reason: 'ancestry-depth-change',\r\n      source: 'controls',\r\n      reposition: true,\r\n      preservePreferences: true\r\n    })\r\n  })\r\n\r\n  progenyDepthControl?.addEventListener('change', () => {\r\n    if (isApplyingViewerConfig) return\r\n    const fallback = viewerConfig.progenyDepth ?? DEFAULT_CHART_CONFIG.progenyDepth ?? null\r\n    const value = parseDepthSelectValue(progenyDepthControl, fallback)\r\n    if (value === viewerConfig.progenyDepth) return\r\n    viewerConfig = { ...viewerConfig, progenyDepth: value }\r\n    requestSubtree({ progenyDepth: value }, {\r\n      reason: 'progeny-depth-change',\r\n      source: 'controls',\r\n      reposition: true,\r\n      preservePreferences: true\r\n    })\r\n  })\r\n\r\n  miniTreeToggle?.addEventListener('change', () => {\r\n    if (isApplyingViewerConfig) return\r\n    const enabled = miniTreeToggle.checked\r\n    const previous = viewerConfig.miniTree !== false\r\n    if (enabled === previous) return\r\n    viewerConfig = { ...viewerConfig, miniTree: enabled }\r\n    applyViewerConfig({ reposition: false })\r\n  })\r\n\r\n  duplicateToggle?.addEventListener('change', () => {\r\n    if (isApplyingViewerConfig) return\r\n    const enabled = duplicateToggle.checked\r\n    const previous = viewerConfig.duplicateBranchToggle !== false\r\n    if (enabled === previous) return\r\n    viewerConfig = { ...viewerConfig, duplicateBranchToggle: enabled }\r\n    applyViewerConfig({ reposition: false })\r\n  })\r\n}\r\n\r\nattachPerformanceHandlers()\r\n\r\nfunction resolveLabelFromSummary(id) {\r\n  if (!id || typeof id !== 'string') return null\r\n  if (peopleSummaryIndex && peopleSummaryIndex.has(id)) {\r\n    const entry = peopleSummaryIndex.get(id)\r\n    if (entry && typeof entry.label === 'string' && entry.label.trim()) {\r\n      return entry.label.trim()\r\n    }\r\n  }\r\n  return null\r\n}\r\n\r\nfunction describeDepthValue(value) {\r\n  if (value === 'auto') return 'auto (progressif)'\r\n  if (value === 'all' || value === null) return 'sans limite'\r\n  if (typeof value === 'number' && Number.isFinite(value)) {\r\n    if (value === 0) return 'profil seul'\r\n    return `${Math.floor(value)}`\r\n  }\r\n  return 'auto (progressif)'\r\n}\r\n\r\nfunction buildDepthSummary(config) {\r\n  const ancestry = describeDepthValue(config.ancestryDepth)\r\n  const progeny = describeDepthValue(config.progenyDepth)\r\n  return `Ancetres: ${ancestry}, Descendants: ${progeny}`\r\n}\r\n\r\nasync function requestSubtree(partialParams = {}, context = {}) {\r\n  const nextParams = {\r\n    ...serverQueryState,\r\n    ...partialParams\r\n  }\r\n\r\n  if (!hasQueryChanged(nextParams) && !context.force) {\r\n    lastSelectionContext = {\r\n      source: context.source || lastSelectionContext.source,\r\n      label: context.selectedLabel || lastSelectionContext.label\r\n    }\r\n    return\r\n  }\r\n\r\n  serverQueryState = { ...nextParams }\r\n  lastSelectionContext = {\r\n    source: context.source || 'system',\r\n    label: context.selectedLabel || resolveLabelFromSummary(nextParams.mainId) || lastSelectionContext.label\r\n  }\r\n\r\n  const loadingLabel = context.loadingLabel\r\n    || (context.source === 'search' ? 'Recherche de la branche...' : 'Chargement de la branche...')\r\n\r\n  setStatus(loadingLabel, 'loading')\r\n  setInterfaceLoading(true)\r\n\r\n  const controller = new AbortController()\r\n  abortActiveFetch()\r\n  activeFetchController = controller\r\n\r\n  const wantsAutoAncestry = nextParams.ancestryDepth === 'auto' || nextParams.ancestryDepth === null\r\n  const wantsAutoProgeny = nextParams.progenyDepth === 'auto' || nextParams.progenyDepth === null\r\n  const shouldProgressiveLoad = !context.disableProgressive && (wantsAutoAncestry || wantsAutoProgeny)\r\n\r\n  try {\r\n    if (shouldProgressiveLoad) {\r\n      await progressiveSubtreeRequest(nextParams, { ...context, controller })\r\n    } else {\r\n      await fetchSubtreeOnce(nextParams, { ...context, controller })\r\n    }\r\n  } finally {\r\n    if (activeFetchController === controller) {\r\n      activeFetchController = null\r\n      setInterfaceLoading(false)\r\n    }\r\n  }\r\n}\r\n\r\nasync function progressiveSubtreeRequest(initialParams, context = {}) {\r\n  const controller = context.controller\r\n  const wantsAutoAncestry = initialParams.ancestryDepth === 'auto' || initialParams.ancestryDepth === null\r\n  const wantsAutoProgeny = initialParams.progenyDepth === 'auto' || initialParams.progenyDepth === null\r\n  const stepInput = Number.isFinite(context.progressiveStep) && context.progressiveStep > 0\r\n    ? Math.floor(context.progressiveStep)\r\n    : PROGRESSIVE_DEPTH_STEP\r\n  const stepSize = Math.max(1, stepInput)\r\n\r\n  const currentParams = { ...initialParams }\r\n  if (wantsAutoAncestry) {\r\n    const fallback = Number.isFinite(DEFAULT_CHART_CONFIG.ancestryDepth)\r\n      ? Math.max(0, DEFAULT_CHART_CONFIG.ancestryDepth)\r\n      : stepSize\r\n    currentParams.ancestryDepth = Math.max(stepSize, fallback)\r\n  }\r\n\r\n  if (wantsAutoProgeny) {\r\n    const fallback = Number.isFinite(DEFAULT_CHART_CONFIG.progenyDepth)\r\n      ? Math.max(0, DEFAULT_CHART_CONFIG.progenyDepth)\r\n      : stepSize\r\n    currentParams.progenyDepth = Math.max(stepSize, fallback)\r\n  }\r\n\r\n  const originalSnapshot = {\r\n    ...initialParams,\r\n    ancestryDepth: wantsAutoAncestry ? 'auto' : initialParams.ancestryDepth,\r\n    progenyDepth: wantsAutoProgeny ? 'auto' : initialParams.progenyDepth\r\n  }\r\n  let iterations = 0\r\n  let previousCount = chartInstance?.store?.getTree?.()?.data?.length ?? 0\r\n  let encounteredError = false\r\n\r\n  while (iterations < PROGRESSIVE_MAX_STEPS) {\r\n    iterations += 1\r\n\r\n    if (controller?.signal?.aborted) {\r\n      return\r\n    }\r\n\r\n    if (wantsAutoAncestry || wantsAutoProgeny) {\r\n      const summaryParts = []\r\n      if (wantsAutoAncestry) summaryParts.push(`anc\u00EAtres \u2264 ${currentParams.ancestryDepth}`)\r\n      if (wantsAutoProgeny) summaryParts.push(`descendants \u2264 ${currentParams.progenyDepth}`)\r\n      if (summaryParts.length) {\r\n        setStatus(`Chargement progressif (${summaryParts.join(', ')})...`, 'loading')\r\n      }\r\n    }\r\n\r\n    const result = await fetchSubtreeOnce(currentParams, {\r\n      ...context,\r\n      controller,\r\n      progressiveBatch: true,\r\n      reposition: iterations === 1 ? context.reposition : false\r\n    })\r\n\r\n    if (!result || result.aborted) {\r\n      return\r\n    }\r\n\r\n    if (result.error) {\r\n      encounteredError = true\r\n      break\r\n    }\r\n\r\n    const meta = result.meta || {}\r\n    const currentCount = chartInstance?.store?.getTree?.()?.data?.length ?? meta.returned ?? previousCount\r\n    const gained = currentCount - previousCount\r\n    previousCount = currentCount\r\n\r\n    if (gained <= 0) {\r\n      break\r\n    }\r\n\r\n    if (wantsAutoAncestry) {\r\n      currentParams.ancestryDepth += stepSize\r\n    }\r\n\r\n    if (wantsAutoProgeny) {\r\n      currentParams.progenyDepth += stepSize\r\n    }\r\n  }\r\n\r\n  if (encounteredError) {\r\n    return\r\n  }\r\n\r\n  lastSuccessfulQuery = { ...originalSnapshot }\r\n  serverQueryState = {\r\n    ...serverQueryState,\r\n    ...originalSnapshot\r\n  }\r\n\r\n  if (viewerConfig) {\r\n    viewerConfig = { ...viewerConfig }\r\n    if (wantsAutoAncestry) viewerConfig.ancestryDepth = 'auto'\r\n    if (wantsAutoProgeny) viewerConfig.progenyDepth = 'auto'\r\n    isApplyingViewerConfig = true\r\n    updatePerformanceControlsUI(viewerConfig)\r\n    isApplyingViewerConfig = false\r\n  }\r\n}\r\n\r\nasync function fetchSubtreeOnce(params, context = {}) {\r\n  const controller = context.controller || new AbortController()\r\n  if (!context.controller) {\r\n    abortActiveFetch()\r\n    activeFetchController = controller\r\n  }\r\n\r\n  const queryString = buildSubtreeQuery(params)\r\n\r\n  try {\r\n    const response = await fetch(`/api/tree?${queryString}`, { cache: 'no-store', signal: controller.signal })\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP ${response.status}`)\r\n    }\r\n\r\n    const payload = await response.json()\r\n    if (controller.signal.aborted) {\r\n      return { aborted: true }\r\n    }\r\n\r\n    const normalised = normaliseTreePayload(payload)\r\n    const persons = Array.isArray(normalised.data) ? normalised.data : []\r\n    const metaInfo = normaliseMeta(normalised.meta, persons.length)\r\n\r\n    if (!persons.length && context.reason === 'initial' && !context.allowEmpty) {\r\n      await fetchFullTree({\r\n        ...context,\r\n        preservePreferences: false,\r\n        loadingLabel: 'Chargement complet de l\\'arbre...',\r\n        source: context.source || 'system'\r\n      })\r\n      return { aborted: false, meta: metaInfo }\r\n    }\r\n\r\n    lastSuccessfulQuery = { ...params }\r\n    applySubtreePayload({\r\n      data: persons,\r\n      config: normalised.config,\r\n      meta: metaInfo\r\n    }, {\r\n      ...context,\r\n      params\r\n    })\r\n\r\n    return { aborted: false, meta: metaInfo }\r\n  } catch (error) {\r\n    if (error.name === 'AbortError') {\r\n      return { aborted: true, error }\r\n    }\r\n    console.error('Erreur de chargement de sous-arbre', error)\r\n    setStatus(`Erreur: ${(error && error.message) || 'chargement interrompu'}`, 'error')\r\n    return { aborted: false, error }\r\n  }\r\n}\r\n\r\nfunction fetchFullTree(context = {}) {\r\n  const loadingLabel = context.loadingLabel || 'Chargement complet de l\\'arbre...'\r\n  setStatus(loadingLabel, 'loading')\r\n  setInterfaceLoading(true)\r\n\r\n  return fetch('/api/tree', { cache: 'no-store' })\r\n    .then(response => {\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP ${response.status}`)\r\n      }\r\n      return response.json()\r\n    })\r\n    .then(payload => {\r\n      const normalised = normaliseTreePayload(payload)\r\n      const persons = Array.isArray(normalised.data) ? normalised.data : []\r\n      const metaInfo = normaliseMeta(normalised.meta, persons.length)\r\n      latestMeta = metaInfo\r\n      totalPersons = metaInfo.total\r\n\r\n      const resolvedMainId = context.mainId\r\n        || (typeof normalised.config?.mainId === 'string' ? normalised.config.mainId : null)\r\n        || (persons[0]?.id ?? null)\r\n\r\n      if (resolvedMainId) {\r\n        serverQueryState = { ...serverQueryState, mainId: resolvedMainId }\r\n      }\r\n\r\n      lastSuccessfulQuery = null\r\n\r\n      renderChart({\r\n        data: persons,\r\n        config: normalised.config,\r\n        meta: metaInfo\r\n      }, {\r\n        preservePreferences: context.preservePreferences !== false,\r\n        reposition: true,\r\n        source: context.source || 'system',\r\n        selectedLabel: context.selectedLabel,\r\n        mainId: resolvedMainId\r\n      })\r\n    })\r\n    .catch(error => {\r\n      console.error('Erreur lors du chargement complet de l\\'arbre', error)\r\n      setStatus(`Erreur: ${(error && error.message) || 'chargement impossible'}`, 'error')\r\n    })\r\n    .finally(() => {\r\n      setInterfaceLoading(false)\r\n    })\r\n}\r\n\r\nfunction applySubtreePayload(payload, context = {}) {\r\n  const { data, config, meta } = normaliseTreePayload(payload)\r\n  const persons = Array.isArray(data) ? data : []\r\n  const metaInfo = normaliseMeta(meta, persons.length)\r\n  latestMeta = metaInfo\r\n  totalPersons = metaInfo.total\r\n\r\n  const requestedParams = context.params || {}\r\n  const resolvedMainId = requestedParams.mainId\r\n    || (typeof config?.mainId === 'string' ? config.mainId : null)\r\n    || (persons[0]?.id ?? serverQueryState.mainId ?? null)\r\n\r\n  serverQueryState = {\r\n    ...serverQueryState,\r\n    mainId: resolvedMainId,\r\n    ancestryDepth: requestedParams.ancestryDepth ?? serverQueryState.ancestryDepth,\r\n    progenyDepth: requestedParams.progenyDepth ?? serverQueryState.progenyDepth,\r\n    includeSiblings: requestedParams.includeSiblings ?? serverQueryState.includeSiblings,\r\n    includeSpouses: requestedParams.includeSpouses ?? serverQueryState.includeSpouses\r\n  }\r\n\r\n  const selectedLabel = context.selectedLabel || resolveLabelFromSummary(resolvedMainId)\r\n  renderChart({ data: persons, config, meta: metaInfo }, {\r\n    preservePreferences: context.preservePreferences !== false,\r\n    reposition: context.reposition !== false,\r\n    source: context.source || lastSelectionContext.source,\r\n    selectedLabel,\r\n    mainId: resolvedMainId\r\n  })\r\n}\r\n\r\nfunction resetDetails() {\r\n  if (!detailsPanel || !emptyState || !detailsList || !detailsSummary) return\r\n  detailsSummary.textContent = ''\r\n  detailsSummary.classList.add('hidden')\r\n  emptyState.textContent = 'S\u00E9lectionnez une personne pour afficher les informations.'\r\n  emptyState.classList.remove('hidden')\r\n  detailsList.innerHTML = ''\r\n  updateDatasetMeta()\r\n}\r\n\r\nfunction buildFullName(person = {}) {\r\n  const nameParts = [person['first name'], person['last name']].filter(Boolean)\r\n  return nameParts.join(' ').trim()\r\n}\r\n\r\nfunction hasContent(value) {\r\n  if (value === null || value === undefined) return false\r\n  if (typeof value === 'string') return value.trim().length > 0\r\n  if (Array.isArray(value)) return value.length > 0\r\n  if (typeof value === 'object') return Object.keys(value).length > 0\r\n  return true\r\n}\r\n\r\nfunction buildDetailEntries(person = {}) {\r\n  const normalizedPerson = person || {}\r\n  const entries = DETAIL_FIELD_ORDER.map(field => ({\r\n    field,\r\n    value: normalizedPerson[field],\r\n    mandatory: true\r\n  }))\r\n\r\n  const seen = new Set(DETAIL_FIELD_ORDER)\r\n  Object.entries(normalizedPerson).forEach(([field, value]) => {\r\n    if (seen.has(field)) return\r\n    if (!hasContent(value)) return\r\n    entries.push({ field, value, mandatory: false })\r\n  })\r\n\r\n  return entries\r\n}\r\n\r\nfunction formatFieldLabel(rawField) {\r\n  if (!rawField) return ''\r\n  const field = rawField.toLowerCase()\r\n  if (FIELD_LABELS[field]) return FIELD_LABELS[field]\r\n  return field.replace(/\\b\\w/g, char => char.toUpperCase())\r\n}\r\n\r\nfunction formatArrayValue(value) {\r\n  return value\r\n    .map(item => {\r\n      if (typeof item === 'string') return item.trim()\r\n      if (typeof item === 'object' && item !== null) return JSON.stringify(item)\r\n      return String(item)\r\n    })\r\n    .filter(Boolean)\r\n    .join(', ')\r\n}\r\n\r\nfunction resolveFieldDisplay(field, rawValue) {\r\n  if (rawValue === undefined) {\r\n    return { text: DEFAULT_EMPTY_LABEL, empty: true }\r\n  }\r\n\r\n  if (field === 'avatar') {\r\n    const url = (rawValue || '').toString().trim()\r\n    if (!url) return { text: DEFAULT_EMPTY_LABEL, empty: true }\r\n    return { type: 'avatar', url }\r\n  }\r\n\r\n  if (field === 'gender' && typeof rawValue === 'string') {\r\n    const transformed = GENDER_LABELS[rawValue.toUpperCase()] || rawValue\r\n    return { text: transformed }\r\n  }\r\n\r\n  if (rawValue === null) {\r\n    return { text: DEFAULT_EMPTY_LABEL, empty: true }\r\n  }\r\n\r\n  if (Array.isArray(rawValue)) {\r\n    if (!rawValue.length) return { text: DEFAULT_EMPTY_LABEL, empty: true }\r\n    return { text: formatArrayValue(rawValue) }\r\n  }\r\n\r\n  if (typeof rawValue === 'object') {\r\n    const json = JSON.stringify(rawValue, null, 2)\r\n    if (!json) return { text: DEFAULT_EMPTY_LABEL, empty: true }\r\n    return { text: json, pre: true }\r\n  }\r\n\r\n  const value = String(rawValue).trim()\r\n  if (!value) return { text: DEFAULT_EMPTY_LABEL, empty: true }\r\n\r\n  const isLongText = value.includes('\\n') || value.length > 80\r\n  return { text: value, pre: isLongText }\r\n}\r\n\r\nfunction createDetailItem(field, display) {\r\n  if (!detailsList) return\r\n  const item = document.createElement('article')\r\n  item.className = 'detail-item'\r\n\r\n  const labelEl = document.createElement('span')\r\n  labelEl.className = 'detail-label'\r\n  labelEl.textContent = formatFieldLabel(field)\r\n  item.append(labelEl)\r\n\r\n  if (display.type === 'avatar') {\r\n    const valueEl = document.createElement('div')\r\n    valueEl.className = 'avatar-preview'\r\n\r\n    const img = document.createElement('img')\r\n    img.src = display.url\r\n    img.alt = `Avatar de ${detailsSummary?.textContent || 'la personne s\u00E9lectionn\u00E9e'}`\r\n    img.loading = 'lazy'\r\n\r\n    const link = document.createElement('a')\r\n    link.href = display.url\r\n    link.target = '_blank'\r\n    link.rel = 'noopener'\r\n    link.textContent = 'Ouvrir l\u2019image'\r\n\r\n    valueEl.append(img, link)\r\n    item.append(valueEl)\r\n    detailsList.append(item)\r\n    return\r\n  }\r\n\r\n  const valueEl = document.createElement('div')\r\n  valueEl.className = 'detail-value'\r\n  if (display.pre) valueEl.classList.add('preformatted')\r\n  if (display.empty) valueEl.classList.add('empty')\r\n  valueEl.textContent = display.text\r\n  item.append(valueEl)\r\n  detailsList.append(item)\r\n}\r\n\r\nfunction showDetailsForDatum(datum) {\r\n  if (!detailsPanel || !detailsList || !emptyState || !detailsSummary) return\r\n  const person = datum?.data || {}\r\n\r\n  detailsList.innerHTML = ''\r\n\r\n  const fullName = buildFullName(person)\r\n  const highlight = []\r\n  if (person['birthday']) highlight.push(`N\u00E9(e) : ${person['birthday']}`)\r\n  if (person['death']) highlight.push(`D\u00E9c\u00E8s : ${person['death']}`)\r\n\r\n  if (fullName) {\r\n    detailsSummary.textContent = highlight.length ? `${fullName} \u00B7 ${highlight.join(' \u00B7 ')}` : fullName\r\n    detailsSummary.classList.remove('hidden')\r\n  } else if (highlight.length) {\r\n    detailsSummary.textContent = highlight.join(' \u00B7 ')\r\n    detailsSummary.classList.remove('hidden')\r\n  } else {\r\n    detailsSummary.textContent = ''\r\n    detailsSummary.classList.add('hidden')\r\n  }\r\n\r\n  const entries = buildDetailEntries(person)\r\n  let rendered = 0\r\n  entries.forEach(entry => {\r\n    const display = resolveFieldDisplay(entry.field, entry.value)\r\n    if (display.empty) return\r\n    createDetailItem(entry.field, display)\r\n    rendered += 1\r\n  })\r\n\r\n  if (rendered === 0) {\r\n    emptyState.textContent = 'Aucune information suppl\u00E9mentaire disponible.'\r\n    emptyState.classList.remove('hidden')\r\n  } else {\r\n    emptyState.classList.add('hidden')\r\n  }\r\n\r\n}\r\n\r\nfunction handlePersonSelection(datum, source = 'card') {\r\n  if (!datum) return\r\n\r\n  const name = buildFullName(datum.data || {}) || `Profil ${datum.id}`\r\n  showDetailsForDatum(datum)\r\n\r\n  if (chartInstance) {\r\n    chartInstance.updateMainId(datum.id)\r\n    chartInstance.updateTree({ initial: false, tree_position: 'main_to_middle' })\r\n  }\r\n\r\n  const prefixLabel = source === 'search' ? 'Resultat' : 'Selection'\r\n  setStatus(`${prefixLabel} : ${name}`, 'info')\r\n\r\n  if (source === 'search') {\r\n    const input = searchContainer?.querySelector('input')\r\n    if (input) {\r\n      input.value = ''\r\n      input.blur()\r\n    }\r\n  }\r\n\r\n  requestSubtree({ mainId: datum.id }, {\r\n    source,\r\n    reposition: true,\r\n    preservePreferences: true,\r\n    selectedLabel: name,\r\n    loadingLabel: `${source === 'search' ? 'Recherche' : 'Selection'} : ${name}...`\r\n  })\r\n}\r\n\r\nfunction setupSearch(chart) {\r\n  if (!searchContainer) return\r\n\r\n  searchContainer.innerHTML = ''\r\n\r\n  chart.setPersonDropdown(datum => {\r\n    const person = datum.data || {}\r\n    const name = buildFullName(person) || 'Profil sans nom'\r\n    const extras = []\r\n    if (person['birthday']) extras.push(person['birthday'])\r\n    if (person['death']) extras.push(`\u271D ${person['death']}`)\r\n    return extras.length ? `${name} (${extras.join(' \u00B7 ')})` : name\r\n  }, {\r\n    cont: searchContainer,\r\n  placeholder: 'Rechercher une personne...',\r\n    onSelect: (id) => {\r\n      const selected = chart.store?.getDatum?.(id)\r\n      if (selected) {\r\n        handlePersonSelection(selected, 'search')\r\n        return\r\n      }\r\n      const fallbackLabel = resolveLabelFromSummary(id) || `Profil ${id}`\r\n      requestSubtree({ mainId: id }, {\r\n        source: 'search',\r\n        reposition: true,\r\n        preservePreferences: true,\r\n        selectedLabel: fallbackLabel,\r\n        loadingLabel: `Recherche : ${fallbackLabel}...`\r\n      })\r\n    }\r\n  })\r\n\r\n  const itemsContainer = searchContainer.querySelector('.f3-autocomplete-items')\r\n  if (itemsContainer) {\r\n    const toggleItemsState = () => {\r\n      const hasChildren = itemsContainer.childElementCount > 0\r\n      itemsContainer.classList.toggle('is-empty', !hasChildren)\r\n      if (hasChildren) {\r\n        itemsContainer.tabIndex = 0\r\n      } else {\r\n        itemsContainer.removeAttribute('tabindex')\r\n      }\r\n    }\r\n\r\n    toggleItemsState()\r\n    const observer = new MutationObserver(toggleItemsState)\r\n    observer.observe(itemsContainer, { childList: true })\r\n  }\r\n\r\n  const searchInput = searchContainer.querySelector('input')\r\n  if (searchInput) {\r\n    searchInput.id = 'personSearchInput'\r\n  }\r\n\r\n  updateSearchOptionsForChart(chart)\r\n  ensurePeopleSummary().then(() => {\r\n    updateSearchOptionsForChart(chart)\r\n  }).catch(() => {})\r\n}\r\n\r\nfunction renderChart(payload, options = {}) {\r\n  const container = document.querySelector(chartSelector)\r\n  if (!container) {\r\n    throw new Error('Conteneur du graphique introuvable')\r\n  }\r\n\r\n  if (chartInstance && typeof chartInstance.unSetPersonSearch === 'function') {\r\n    chartInstance.unSetPersonSearch()\r\n  }\r\n\r\n  container.innerHTML = ''\r\n  resetDetails()\r\n\r\n  const normalised = payload && payload.data !== undefined\r\n    ? payload\r\n    : normaliseTreePayload(payload)\r\n\r\n  const dataArray = Array.isArray(normalised.data) ? normalised.data : []\r\n  const rawConfig = normalised.config || {}\r\n\r\n  const chart = f3.createChart(chartSelector, dataArray)\r\n  const baseConfig = applyConfigToChart(chart, rawConfig)\r\n\r\n  const mergedConfig = {\r\n    ...baseConfig,\r\n    mainId: options.mainId || baseConfig.mainId || viewerConfig.mainId || null,\r\n    ancestryDepth: serverQueryState.ancestryDepth,\r\n    progenyDepth: serverQueryState.progenyDepth,\r\n    duplicateBranchToggle: options.preservePreferences && viewerConfig ? viewerConfig.duplicateBranchToggle !== false : baseConfig.duplicateBranchToggle,\r\n    miniTree: options.preservePreferences && viewerConfig ? viewerConfig.miniTree !== false : baseConfig.miniTree !== false,\r\n    cardDisplay: baseConfig.cardDisplay && baseConfig.cardDisplay.length\r\n      ? baseConfig.cardDisplay.map(row => [...row])\r\n      : DEFAULT_CARD_DISPLAY.map(row => [...row])\r\n  }\r\n\r\n  if (options.preservePreferences && viewerConfig) {\r\n    mergedConfig.cardDisplay = viewerConfig.cardDisplay && viewerConfig.cardDisplay.length\r\n      ? viewerConfig.cardDisplay.map(row => [...row])\r\n      : mergedConfig.cardDisplay\r\n    mergedConfig.transitionTime = viewerConfig.transitionTime ?? mergedConfig.transitionTime\r\n    mergedConfig.cardXSpacing = viewerConfig.cardXSpacing ?? mergedConfig.cardXSpacing\r\n    mergedConfig.cardYSpacing = viewerConfig.cardYSpacing ?? mergedConfig.cardYSpacing\r\n    mergedConfig.singleParentEmptyCard = viewerConfig.singleParentEmptyCard ?? mergedConfig.singleParentEmptyCard\r\n    mergedConfig.singleParentEmptyCardLabel = viewerConfig.singleParentEmptyCardLabel ?? mergedConfig.singleParentEmptyCardLabel\r\n    mergedConfig.orientation = viewerConfig.orientation ?? mergedConfig.orientation\r\n  }\r\n\r\n  viewerConfig = { ...mergedConfig }\r\n  viewerConfig.mainId = mergedConfig.mainId\r\n\r\n  chartInstance = chart\r\n\r\n  const initialCardDisplay = viewerConfig.cardDisplay && viewerConfig.cardDisplay.length\r\n    ? viewerConfig.cardDisplay.map(row => [...row])\r\n    : DEFAULT_CARD_DISPLAY.map(row => [...row])\r\n\r\n  const card = chart.setCardHtml()\r\n    .setCardDisplay(initialCardDisplay)\r\n    .setMiniTree(viewerConfig.miniTree !== false)\r\n\r\n  cardInstance = card\r\n\r\n  chart.setDuplicateBranchToggle(viewerConfig.duplicateBranchToggle !== false)\r\n\r\n  isApplyingViewerConfig = true\r\n  updatePerformanceControlsUI(viewerConfig)\r\n  isApplyingViewerConfig = false\r\n\r\n  card.setOnCardClick((event, treeDatum) => {\r\n    card.onCardClickDefault(event, treeDatum)\r\n    const id = treeDatum?.data?.id\r\n    if (!id) return\r\n    const datum = chart.store?.getDatum?.(id)\r\n    if (datum) {\r\n      handlePersonSelection(datum, 'card')\r\n    } else {\r\n      const fallbackLabel = resolveLabelFromSummary(id) || `Profil ${id}`\r\n      requestSubtree({ mainId: id }, {\r\n        source: 'card',\r\n        reposition: true,\r\n        preservePreferences: true,\r\n        selectedLabel: fallbackLabel,\r\n        loadingLabel: `Selection : ${fallbackLabel}...`\r\n      })\r\n    }\r\n  })\r\n\r\n  if (viewerConfig.mainId) {\r\n    chart.updateMainId(viewerConfig.mainId)\r\n  }\r\n\r\n  setupSearch(chart)\r\n\r\n  applyViewerConfig({ reposition: options.reposition !== false, initial: options.preservePreferences === false })\r\n\r\n  const mainDatum = chart.getMainDatum?.()\r\n  const effectiveMainId = chart.store?.getMainId?.() || viewerConfig.mainId\r\n  if (effectiveMainId && effectiveMainId !== viewerConfig.mainId) {\r\n    viewerConfig.mainId = effectiveMainId\r\n  }\r\n  if (effectiveMainId) {\r\n    serverQueryState.mainId = effectiveMainId\r\n    if (lastSuccessfulQuery) {\r\n      lastSuccessfulQuery = { ...lastSuccessfulQuery, mainId: effectiveMainId }\r\n    }\r\n  }\r\n  if (mainDatum) {\r\n    showDetailsForDatum(mainDatum)\r\n  }\r\n\r\n  updateDatasetMeta()\r\n\r\n  const branchCount = Number.isFinite(latestMeta.returned) ? latestMeta.returned : dataArray.length\r\n  const totalCount = Number.isFinite(latestMeta.total) ? latestMeta.total : dataArray.length\r\n  const name = mainDatum\r\n    ? (buildFullName(mainDatum.data || {}) || `Profil ${mainDatum.id}`)\r\n    : (options.selectedLabel || 'Branche courante')\r\n  const prefix = options.source === 'search'\r\n    ? 'Resultat'\r\n    : options.source === 'card'\r\n      ? 'Selection'\r\n      : 'Branche'\r\n  const depthSummary = buildDepthSummary(viewerConfig)\r\n  setStatus(`${prefix} : ${name} - ${branchCount} profil(s) dans la branche / ${totalCount} au total - ${depthSummary}`, 'success')\r\n\r\n  lastSelectionContext = { source: options.source || prefix.toLowerCase(), label: name }\r\n\r\n  ensurePeopleSummary().then(() => {\r\n    updateSearchOptionsForChart(chart)\r\n  }).catch(() => {})\r\n}\r\n\r\nfetchFullTree({ preservePreferences: false, source: 'system' }).catch(() => {\r\n  setStatus('Impossible de charger les donn\u00E9es', 'error')\r\n})\r\n"],
  "mappings": "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",
  "names": ["f3", "statusEl", "detailsPanel", "searchContainer", "detailsList", "detailsSummary", "emptyState", "chartSelector", "ancestryDepthControl", "progenyDepthControl", "miniTreeToggle", "duplicateToggle", "datasetMeta", "visibleCountEl", "branchCountEl", "totalCountEl", "normalizeFieldKey", "value", "sanitizeFieldValues", "values", "seen", "result", "rawValue", "trimmed", "key", "DETAIL_FIELD_ORDER", "FIELD_LABELS", "GENDER_LABELS", "DEFAULT_EMPTY_LABEL", "DEFAULT_CARD_DISPLAY", "DEFAULT_CHART_CONFIG", "row", "PROGRESSIVE_DEPTH_STEP", "PROGRESSIVE_MAX_STEPS", "chartInstance", "cardInstance", "viewerConfig", "totalPersons", "isApplyingViewerConfig", "serverQueryState", "lastSuccessfulQuery", "latestMeta", "activeFetchController", "searchSummaryPromise", "peopleSummary", "searchOptions", "lastSelectionContext", "peopleSummaryIndex", "pendingMetaFrame", "lastMetaSnapshot", "lastStatusSnapshot", "normalizeCardDisplay", "rows", "normalized", "normaliseTreePayload", "payload", "meta", "candidateConfig", "normaliseChartConfig", "rawConfig", "_a", "_b", "_c", "_d", "_e", "_f", "_g", "_h", "_i", "_j", "_k", "_l", "_m", "_n", "_o", "_p", "_q", "_r", "_s", "_t", "_u", "_v", "_w", "_x", "_y", "_z", "_A", "_B", "_C", "_D", "config", "transition", "cardX", "cardY", "orientation", "showSiblings", "singleParentEnabled", "emptyLabel", "rawCardDisplay", "source", "rawMainId", "rawAncestryDepth", "rawProgenyDepth", "rawMiniTree", "rawDuplicateToggle", "applyConfigToChart", "chart", "overrides", "cardDisplayOverride", "serialiseDepthParam", "buildSubtreeQuery", "params", "query", "ancestryDepth", "progenyDepth", "setInterfaceLoading", "isLoading", "loading", "abortActiveFetch", "normaliseMeta", "fallbackTotal", "fallbackReturned", "payloadMeta", "total", "returned", "hasQueryChanged", "nextParams", "previous", "next", "buildSearchOption", "person", "label", "metaParts", "option", "title", "buildSearchOptionsFromSummary", "summary", "options", "a", "b", "setSearchLoadingState", "state", "ensurePeopleSummary", "force", "controller", "promise", "response", "error", "updateSearchOptionsForChart", "setStatus", "message", "type", "depthToSelectValue", "fallback", "parseDepthSelectValue", "select", "raw", "updatePerformanceControlsUI", "updateDatasetMeta", "cb", "visible", "branchCount", "applyViewerConfig", "reposition", "initial", "attachPerformanceHandlers", "requestSubtree", "enabled", "resolveLabelFromSummary", "id", "entry", "describeDepthValue", "buildDepthSummary", "ancestry", "progeny", "partialParams", "context", "loadingLabel", "wantsAutoAncestry", "wantsAutoProgeny", "shouldProgressiveLoad", "progressiveSubtreeRequest", "fetchSubtreeOnce", "initialParams", "stepInput", "stepSize", "currentParams", "originalSnapshot", "iterations", "previousCount", "encounteredError", "summaryParts", "currentCount", "gained", "queryString", "normalised", "persons", "metaInfo", "fetchFullTree", "applySubtreePayload", "resolvedMainId", "renderChart", "data", "requestedParams", "selectedLabel", "resetDetails", "buildFullName", "hasContent", "buildDetailEntries", "normalizedPerson", "entries", "field", "formatFieldLabel", "rawField", "char", "formatArrayValue", "item", "resolveFieldDisplay", "url", "json", "isLongText", "createDetailItem", "display", "labelEl", "valueEl", "img", "link", "showDetailsForDatum", "datum", "fullName", "highlight", "rendered", "handlePersonSelection", "name", "input", "setupSearch", "extras", "selected", "fallbackLabel", "itemsContainer", "toggleItemsState", "hasChildren", "searchInput", "container", "dataArray", "baseConfig", "mergedConfig", "initialCardDisplay", "card", "event", "treeDatum", "mainDatum", "effectiveMainId", "totalCount", "prefix", "depthSummary"]
}
